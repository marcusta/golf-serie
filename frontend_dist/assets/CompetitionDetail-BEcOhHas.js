import{j as e,b as R,c as Q,C as xe,U as D,e as A,P as L,f as ue,g as pe,r as p,h as fe,i as ge,k as je,l as ye,m as be,n as Ne,o as we,p as ve,q as _e,s as M,t as Ce,v as Se,w as Le,x as Ie,G as Pe,y as ke,z as Te,J as De,Q as Ee,B as Fe}from"./index-CeWQ5JRe.js";import{C as $e,a as He,g as Oe,d as Ge,c as Ue,P as Me,L as Re,T as Qe,b as Ae,e as Be}from"./TeamResultComponent-BOrGyeqG.js";function Je({seriesId:t,seriesName:o}){return e.jsx(R,{to:"/player/series/$serieId",params:{serieId:t.toString()},className:"block border-l-4 border-turf pl-4 py-3 hover:bg-turf/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-turf"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-turf font-semibold uppercase",children:"Part of a Series"}),e.jsx("h4",{className:"font-semibold text-charcoal group-hover:text-fairway transition-colors",children:o})]})]}),e.jsx(xe,{className:"h-5 w-5 text-turf/50 group-hover:text-fairway transition-colors"})]})})}function We(t,o){const g=o?t.find(l=>l.tee_time_id===o):void 0,w=o?t.filter(l=>l.tee_time_id!==o):t,a=[],i=[],x=[];for(const l of w)l.status==="on_course"?a.push(l):l.status==="finished"?x.push(l):i.push(l);return{myGroup:g,onCourse:a,registered:i,finished:x}}function ze(t){if(t.members.length===0)return 0;const o=t.members.map(g=>g.holes_played||0);return Math.min(...o)}function Ye(t){if(!t||t==="-")return;if(t==="E")return 0;const o=parseInt(t,10);return isNaN(o)?void 0:o}function qe(t){switch(t){case"on_course":return"On Course";case"finished":return"Finished";default:return"Registered"}}function Ke({groups:t,isLoading:o,myTeeTimeId:g,isOpenStart:w=!0}){if(o)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-coral border-t-transparent rounded-full"})});if(!t||t.length===0)return e.jsxs("div",{className:"text-center py-12 text-charcoal/70",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-charcoal/30"}),e.jsx("p",{className:"text-lg font-medium",children:"No players yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Players will appear here once they register"})]});const{myGroup:a,onCourse:i,registered:x,finished:l}=We(t,g),I=t.reduce((r,h)=>r+h.members.length,0),v=i.length+((a==null?void 0:a.status)==="on_course"?1:0),s=r=>{const h=r.current_score,f=Ye(h),c=f!==void 0?Oe(f):"text-charcoal";return e.jsxs("div",{className:"px-4 py-3 flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-fairway truncate",children:r.name}),e.jsxs("div",{className:"text-xs text-charcoal/50 mt-0.5",children:[r.category_name&&e.jsxs("span",{children:["(",r.category_name,") "]}),"HCP ",r.handicap!==void 0?r.handicap.toFixed(1):"-"]})]}),h&&h!=="-"&&e.jsx("div",{className:`text-sm font-semibold ml-3 ${c}`,children:h})]},r.player_id)},y=(r,h,f)=>e.jsxs("div",{className:`border-l-4 transition-colors ${f?"border-turf":"border-soft-grey hover:border-turf"}`,children:[e.jsxs("div",{className:"bg-rough/20 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-charcoal/50 font-primary",children:[r.members.length," player",r.members.length!==1?"s":""]}),h]}),e.jsx("div",{className:"divide-y divide-soft-grey/50",children:r.members.map(s)})]},r.tee_time_id),d=r=>{if(r.status==="on_course"){const h=ze(r);if(h>0)return e.jsxs("span",{className:"text-xs text-charcoal/60 font-semibold font-primary",children:["Hole ",h]})}return r.status==="finished"?e.jsx("span",{className:"text-xs text-charcoal/60 font-medium font-primary",children:"Done"}):null};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-charcoal/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs("span",{children:[I," players"]})]}),v>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4 text-coral"}),e.jsxs("span",{children:[v," on course"]})]})]}),a&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-turf"}),"Your Group",e.jsx("span",{className:"text-xs text-coral font-semibold",children:qe(a.status)})]}),e.jsx("div",{className:"space-y-3",children:y(a,d(a),!0)})]}),i.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-coral"}),"On Course",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",i.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:i.map(r=>y(r,d(r)))})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-charcoal/40"}),w?"Waiting to Start":"Not Started",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",x.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:x.map(r=>y(r))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-turf"}),"Finished",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",l.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:l.map(r=>y(r,d(r)))})]}),!a&&i.length===0&&x.length===0&&l.length===0&&e.jsx("div",{className:"text-center py-6 text-charcoal/50 text-sm font-primary",children:"No groups in this competition."})]})}function Ze(){var O,G,U;const{competitionId:t}=ue({strict:!1}),o=pe({strict:!1}),g=o==null?void 0:o.fromTeeTime,w=()=>{const n=window.location.hash.replace("#","");return n==="leaderboard"?"leaderboard":n==="teamresult"?"teamresult":"startlist"},[a,i]=p.useState(w),[x,l]=p.useState(null),[I,v]=p.useState(!1),{data:s,isLoading:y}=fe(t?parseInt(t):0),{data:d}=ge((s==null?void 0:s.course_id)||0);je((s==null?void 0:s.series_id)||0);const{data:r,isLoading:h,refetch:f}=ye(t?parseInt(t):0),{data:c,isLoading:B,refetch:b}=be(t?parseInt(t):0),_=c==null?void 0:c.entries,J=c==null?void 0:c.scoringMode,N=c==null?void 0:c.tee,W=c==null?void 0:c.categoryTees,z=c==null?void 0:c.categories,{data:Y,isLoading:q,refetch:K}=Ne(t?parseInt(t):0),[V,E]=p.useState(!1),{data:P}=we(),X=s==null?void 0:s.tour_id,k=P==null?void 0:P.find(n=>n.tour_id===X),F=(k==null?void 0:k.status)==="active",C=(s==null?void 0:s.tour_id)&&(s==null?void 0:s.start_mode)==="open",{data:m,refetch:$}=ve(C?parseInt(t||"0"):0),Z=!!(s!=null&&s.tour_id),{data:ee,isLoading:se}=_e(Z?parseInt(t||"0"):0),te=(O=m==null?void 0:m.registration)==null?void 0:O.participant_id,{data:T}=M(te||0),ae=(((G=T==null?void 0:T.score)==null?void 0:G.filter(n=>n>0).length)??0)>=18,re=p.useCallback(()=>{if(!(s!=null&&s.open_start)||!(s!=null&&s.open_end))return!1;const n=new Date,u=new Date(s.open_start),S=new Date(s.open_end);return n>=u&&n<=S},[s==null?void 0:s.open_start,s==null?void 0:s.open_end]),{data:j}=M(x||0),H=n=>{l(n)},ne=()=>{l(null)},ie=p.useCallback(()=>{window.history.back()},[]),oe=r&&r.length>0&&d?{id:d.id.toString(),name:d.name,holes:r[0].pars.map((n,u)=>({number:u+1,par:n}))}:null,le=j?{id:j.id,team_name:j.team_name,position_name:j.position_name,player_names:j.player_names,score:j.score,tee_time_id:j.tee_time_id}:null,ce=(()=>{if(!x||!_||!(N!=null&&N.strokeIndex))return;const n=_.find(S=>S.participant.id===x);if(!n||n.courseHandicap===void 0)return;const u=Ge(n.courseHandicap,N.strokeIndex);return{strokeIndex:N.strokeIndex,handicapStrokesPerHole:u,courseHandicap:n.courseHandicap,handicapIndex:n.participant.handicap_index}})(),de=p.useMemo(()=>Ce(parseInt(t||"0")),[t]);if(p.useEffect(()=>{const n=()=>{const u=window.location.hash.replace("#","");u==="leaderboard"?i("leaderboard"):u==="teamresult"?i("teamresult"):u==="whosplaying"?i("whosplaying"):(s==null?void 0:s.start_mode)!=="open"?i("startlist"):i("leaderboard")};return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[s==null?void 0:s.start_mode]),p.useEffect(()=>{(s==null?void 0:s.start_mode)==="open"&&a==="startlist"&&i("leaderboard")},[s==null?void 0:s.start_mode,a]),p.useEffect(()=>{if(a==="leaderboard"||a==="teamresult"){const n=`lastFetch-${a}-${t}`,u=sessionStorage.getItem(n);(u?Date.now()-parseInt(u):1/0)>1e4&&(console.log(`Initial fetch for ${a} view...`),b(),a==="teamresult"&&f(),sessionStorage.setItem(n,Date.now().toString()))}},[a,t,b,f]),p.useEffect(()=>{if(!t||a!=="leaderboard"&&a!=="teamresult")return;const n=setInterval(()=>{console.log(`Periodic sync for ${a} view...`),b(),a==="teamresult"&&f()},3e4);return()=>clearInterval(n)},[a,t,b,f]),y)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Loading competition..."});if(!s)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Competition not found"});const me=Ue(r),he=Y||[];return e.jsxs(Se,{title:s.name,subtitle:d==null?void 0:d.name,onBackClick:ie,seriesId:s.series_id,seriesName:s.series_name,customActions:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-2 text-turf hover:text-fairway hover:bg-turf/10 rounded-xl transition-colors text-sm font-medium font-primary",title:"Share startlist",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),g&&e.jsxs(R,{to:`/player/competitions/${t}/tee-times/${g}`,className:"flex items-center gap-2 px-3 py-2 bg-coral text-scorecard rounded-xl hover:bg-[#E8890A] hover:-translate-y-0.5 transition-all duration-200 text-sm font-medium font-primary border border-coral",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to"}),e.jsx("span",{children:"Score"})]})]}),children:[e.jsxs("div",{className:"flex-1 space-y-4 md:space-y-6 p-4 md:p-6",children:[e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-fairway font-display",children:s.name})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-6 text-xs md:text-sm text-charcoal/70 font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"truncate",children:(d==null?void 0:d.name)||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsxs("span",{children:[me," participants"]})]})]}),(s==null?void 0:s.series_id)&&s.series_name&&e.jsx(Je,{seriesId:s.series_id,seriesName:s.series_name}),C&&re()&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-coral/10 border border-coral/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-coral/20 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-coral text-scorecard animate-pulse",children:"OPEN NOW"})}),e.jsxs("p",{className:"text-body-sm text-charcoal/70",children:["Open until"," ",new Date(s.open_end).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),F&&(m!=null&&m.registered)&&m.registration?e.jsx(Pe,{competitionId:parseInt(t||"0"),registration:m.registration,group:m.group,teeTimeId:m.registration.tee_time_id,participantId:m.registration.participant_id,onUpdate:()=>$(),hideActions:ae}):F?e.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-turf hover:bg-fairway text-scorecard rounded-xl font-semibold text-lg transition-colors",children:[e.jsx(L,{className:"h-5 w-5"}),"Join This Round"]}):e.jsx("div",{className:"bg-rough/50 border border-soft-grey rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-body-md text-charcoal/70",children:"You must be enrolled in this tour to join rounds"})})]}),e.jsx("div",{className:"border-b border-soft-grey",children:e.jsxs("nav",{className:"flex space-x-4 md:space-x-8",children:[(s==null?void 0:s.start_mode)!=="open"&&e.jsxs("button",{onClick:()=>{i("startlist"),window.location.hash=""},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="startlist"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(A,{className:"h-3 w-3 md:h-4 md:w-4"}),"Start List"]}),e.jsxs("button",{onClick:()=>{i("leaderboard"),window.location.hash="leaderboard",console.log("Syncing data for leaderboard view..."),b()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                ${a==="leaderboard"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
              `,children:[e.jsx(Q,{className:"h-3 w-3 md:h-4 md:w-4"}),"Leaderboard"]}),C&&e.jsxs("button",{onClick:()=>{i("whosplaying"),window.location.hash="whosplaying"},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="whosplaying"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(ke,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Who's Playing"}),e.jsx("span",{className:"sm:hidden",children:"Groups"})]}),!(s!=null&&s.tour_id)&&e.jsxs("button",{onClick:()=>{i("teamresult"),window.location.hash="teamresult",console.log("Syncing data for team results view..."),b(),K(),f()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="teamresult"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(Te,{className:"h-3 w-3 md:h-4 md:w-4"}),"Team Result"]})]})}),a==="startlist"&&e.jsx(Me,{teeTimes:r,teeTimesLoading:h,competitionId:t,venueType:s==null?void 0:s.venue_type}),a==="leaderboard"&&e.jsx(Re,{leaderboard:_,leaderboardLoading:B,onParticipantClick:H,isTourCompetition:!!(s!=null&&s.tour_id),scoringMode:J,teeInfo:N,categoryTees:W,categories:z}),a==="teamresult"&&e.jsx(Qe,{teamResults:he,leaderboardLoading:q,individualResults:_,onParticipantClick:H}),a==="whosplaying"&&e.jsx(Ke,{groups:ee,isLoading:se,myTeeTimeId:(U=m==null?void 0:m.registration)==null?void 0:U.tee_time_id,isOpenStart:(s==null?void 0:s.start_mode)==="open"})]}),e.jsx(Ae,{visible:x!==null,participant:le,course:oe,onClose:ne,isTourCompetition:!!(s!=null&&s.tour_id),netScoringData:ce}),C&&e.jsx(De,{isOpen:V,onClose:()=>E(!1),competitionId:parseInt(t||"0"),competitionName:(s==null?void 0:s.name)||"",courseName:d==null?void 0:d.name,openUntil:s==null?void 0:s.open_end,onSuccess:()=>$()}),e.jsx(Ee,{open:I,onOpenChange:v,url:de,title:"Share Competition Startlist",description:"Scan this QR code to view the full startlist for this competition"})]})}export{Ze as default};
