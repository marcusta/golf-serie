var ge=Object.defineProperty;var be=(n,t,s)=>t in n?ge(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var le=(n,t,s)=>be(n,typeof t!="symbol"?t+"":t,s);import{p as Ne,j as e,q as C,a as je,o as ve,U as de,s as ue,C as Se,l as we,m as Ce,r as h,R as Ie,P as Pe,t as Ee,v as ke,w as De,x as Ae,X as re,d as Le,e as Re,g as Fe,h as He,y as $e,i as _e,z as Oe,B as Me,D as Ve,E as Ke,F as ze,b as Be,f as Te,G as Ge,H as Ue,k as Ye,I as Je}from"./index-DJziPXhF.js";import{P as We,S as Xe,f as qe,g as Qe,e as Ze,i as et,p as tt,a as st,c as at,H as nt,d as rt,b as ot,T as it,L as lt}from"./pointCalculation-8BvLDq5O.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],dt=Ne("pencil",ct);function ut({activeTab:n,onTabChange:t,className:s}){const a=[{id:"score",label:"Score Entry",shortLabel:"Score",icon:We,disabled:!1},{id:"leaderboard",label:"Leaderboard",shortLabel:"Leaderboard",icon:je,disabled:!1},{id:"teams",label:"Team Results",shortLabel:"Teams",icon:ve,disabled:!1},{id:"participants",label:"Participants",shortLabel:"Start List",icon:de,disabled:!1}];return e.jsx("div",{className:C("bg-scorecard border-t-2 border-soft-grey shadow-[0_-2px_8px_rgba(27,67,50,0.08)]",s),children:e.jsx("div",{className:"grid grid-cols-4 max-w-lg mx-auto",children:a.map(r=>{const d=n===r.id,u=r.icon;return e.jsxs("button",{onClick:()=>!r.disabled&&t(r.id),disabled:r.disabled,className:C("flex flex-col items-center justify-center py-3 px-2 transition-all duration-200 touch-manipulation","min-h-[60px] md:min-h-[64px] font-['Inter']",d?"text-coral bg-gradient-to-b from-coral/10 to-coral/5 border-t-2 border-coral":"text-charcoal hover:text-turf hover:bg-rough/30",r.disabled&&"opacity-50 cursor-not-allowed"),children:[e.jsx(u,{className:C("mb-1 transition-all duration-200",d?"w-6 h-6":"w-5 h-5","md:w-6 md:h-6")}),e.jsxs("span",{className:C("text-xs font-medium transition-all duration-200","md:text-sm",d&&"font-semibold"),children:[e.jsx("span",{className:"sm:hidden",children:r.shortLabel}),e.jsx("span",{className:"hidden sm:inline",children:r.label})]})]},r.id)})})})}function mt({currentHole:n,holePar:t,holeHcp:s,onPrevious:a,onNext:r,canGoPrevious:d,canGoNext:u,className:g}){return e.jsx("div",{className:C("bg-coral text-charcoal px-4 py-2","shadow-lg border-t border-coral/20",g),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,disabled:!d,className:C("p-2 rounded-lg transition-all duration-200 touch-manipulation",d?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(ue,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-8 text-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Par"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:t})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Holes"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:n})]}),s!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"HCP"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:s})]})]}),e.jsx("button",{onClick:r,disabled:!u,className:C("p-2 rounded-lg transition-all duration-200 touch-manipulation",u?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(Se,{className:"w-6 h-6"})})]})})}function ht({competition:n,courseName:t,totalParticipants:s,variant:a="footer"}){const r=a==="header"?"bg-rough/30 rounded-xl p-4 border border-soft-grey":"bg-rough/30 border-t border-soft-grey px-4 py-2 flex-shrink-0";return e.jsx("div",{className:r,children:e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-8 text-label-sm text-charcoal font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(we,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ce,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"truncate",children:t||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{className:"h-4 w-4 text-turf"}),e.jsxs("span",{children:[s," participants"]})]})]})})}function ft({isOpen:n,onClose:t,onSave:s,participant:a}){const[r,d]=h.useState("");h.useEffect(()=>{a&&d(a.currentName||"")},[a]);const u=()=>{if(!a)return;const i=r.trim();i.length!==0&&s(a.id,i)},g=()=>{d((a==null?void 0:a.currentName)||""),t()},x=i=>{i.key==="Enter"?(i.preventDefault(),u()):i.key==="Escape"&&(i.preventDefault(),g())};return a?e.jsx(Ie,{open:n,onOpenChange:t,children:e.jsxs(Pe,{children:[e.jsx(Ee,{className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsx(ke,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm shadow-xl border border-soft-grey max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(De,{className:"text-lg font-semibold text-fairway font-display",children:"Edit Player Name"}),e.jsx(Ae,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors","aria-label":"Close",children:e.jsx(re,{className:"h-4 w-4 text-flag"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-turf font-primary",children:["Editing position:"," ",e.jsx("span",{className:"font-medium",children:a.positionName})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"player-name",className:"block text-sm font-medium text-charcoal mb-2 font-primary",children:"Player Name"}),e.jsx("input",{id:"player-name",type:"text",value:r,onChange:i=>d(i.target.value),onKeyDown:x,className:"w-full p-3 border-2 border-soft-grey rounded-xl text-charcoal font-primary focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors outline-none",placeholder:"Enter player name",autoFocus:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:g,className:"flex-1 p-3 bg-rough bg-opacity-30 text-fairway rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:r.trim().length===0,className:C("flex-1 p-3 rounded-xl font-medium font-primary transition-colors",r.trim().length>0?"bg-turf text-scorecard hover:bg-fairway":"bg-soft-grey text-soft-grey cursor-not-allowed"),children:"Save"})]})]})})]})}):null}function xt({competitionId:n,teeTimeId:t,selectedParticipantId:s}){const{data:a,isLoading:r}=Le(n?parseInt(n):0),{data:d}=Re((a==null?void 0:a.course_id)||0),{data:u,refetch:g}=Fe(n?parseInt(n):0),{data:x,isLoading:i,refetch:m}=He(n?parseInt(n):0),{data:l,refetch:f}=$e(t?parseInt(t):0),{data:k}=_e(s||0),p=Oe();return{competition:a,course:d,teeTimes:u,leaderboard:x,teeTime:l,selectedParticipant:k,isLoading:r,leaderboardLoading:i,refetchTeeTime:f,refetchLeaderboard:m,refetchTeeTimes:g,updateScoreMutation:p}}const ae="golf-pending-scores",ce=3,O=class O{constructor(){}static getInstance(){return O.instance||(O.instance=new O),O.instance}addPendingScore(t,s,a){const r=this.getPendingScores(),d=`${t}-${s}`;r[d]={participantId:t,hole:s,shots:a,timestamp:Date.now(),attempts:0},this.savePendingScores(r)}removePendingScore(t,s){const a=this.getPendingScores(),r=`${t}-${s}`;delete a[r],this.savePendingScores(a)}getPendingScores(){try{const t=localStorage.getItem(ae);return t?JSON.parse(t):{}}catch{return{}}}getPendingScoresArray(){const t=this.getPendingScores();return Object.values(t)}getPendingCount(){return this.getPendingScoresArray().length}markAttempted(t,s){const a=this.getPendingScores(),r=`${t}-${s}`;return a[r]?(a[r].attempts+=1,a[r].attempts>=ce&&delete a[r],this.savePendingScores(a),!!a[r]):!1}clearPendingScores(){localStorage.removeItem(ae)}getRetryableScores(){return this.getPendingScoresArray().filter(t=>t.attempts<ce)}hasConnectivityIssues(){const t=this.getPendingScoresArray(),s=Math.min(...t.map(a=>a.timestamp));return t.length>0&&Date.now()-s>3e4}savePendingScores(t){try{localStorage.setItem(ae,JSON.stringify(t))}catch(s){console.error("Failed to save pending scores to localStorage:",s)}}};le(O,"instance");let ne=O;const A={TAB_CHANGE:15e3,VISIBILITY_CHANGE:6e4,PERIODIC:3e4,HOLE_NAVIGATION:2e4,INITIAL_FETCH:1e4};class D{static shouldSync(t,s){return Date.now()-t>s}static getSessionKey(t,s){return`golf-sync-${t}-${s}`}static needsInitialSync(t){return!sessionStorage.getItem(t)}static markSyncCompleted(t){sessionStorage.setItem(t,Date.now().toString())}static async handleInitialSync(t){if(!t.teeTimeId||!t.hasData)return!1;const s=this.getSessionKey("initial",t.teeTimeId);return this.needsInitialSync(s)?(console.log("Initial sync for score entry session..."),await t.onSync(),this.markSyncCompleted(s),!0):!1}static async handleTabChangeSync(t){const{newTab:s,teeTimeId:a,lastSyncTime:r}=t;s==="score"&&a&&this.shouldSync(r,A.TAB_CHANGE)&&(console.log("Syncing on tab change to score entry..."),await t.onSync()),(s==="leaderboard"||s==="teams")&&(console.log(`Syncing data for ${s} view...`),t.onLeaderboardSync&&await t.onLeaderboardSync(),s==="teams"&&t.onTeamsSync&&await t.onTeamsSync())}static async handleVisibilityChangeSync(t){return document.hidden||!t.isScoreEntry||!t.teeTimeId?!1:this.shouldSync(t.lastSyncTime,A.VISIBILITY_CHANGE)?(console.log("Syncing after returning to tab..."),await t.onSync(),!0):!1}static shouldSyncOnHoleChange(t,s){return t%3===1&&this.shouldSync(s,A.HOLE_NAVIGATION)}static async handleHoleNavigationSync(t){return t.teeTimeId&&this.shouldSyncOnHoleChange(t.currentHole,t.lastSyncTime)?(console.log(`Syncing on hole navigation to hole ${t.currentHole}...`),await t.onSync(),!0):!1}static needsInitialFetch(t,s){const a=`lastFetch-${t}-${s}`,r=sessionStorage.getItem(a);return(r?Date.now()-parseInt(r):1/0)>A.INITIAL_FETCH}static markInitialFetchCompleted(t,s){const a=`lastFetch-${t}-${s}`;sessionStorage.setItem(a,Date.now().toString())}static async handleInitialViewFetch(t,s,a,r){return this.needsInitialFetch(t,s)?(console.log(`Initial fetch for ${t} view...`),await a(),t==="teams"&&r&&await r(),this.markInitialFetchCompleted(t,s),!0):!1}static createSyncStatus(t,s){const a=t.getPendingCount();return{pendingCount:a,lastSyncTime:s,isOnline:navigator.onLine,hasConnectivityIssues:a>0&&Date.now()-s>A.PERIODIC}}static shouldRunPeriodicSync(t){return t==="leaderboard"||t==="teams"}static async handlePeriodicViewSync(t,s,a){this.shouldRunPeriodicSync(t)&&(console.log(`Periodic sync for ${t} view...`),await s(),t==="teams"&&a&&await a())}static shouldRetryPendingScores(t,s){return t.length>0||this.shouldSync(s,A.PERIODIC)}}function pt({competitionId:n,teeTimeId:t,activeTab:s,refetchTeeTime:a,refetchLeaderboard:r,refetchTeeTimes:d,updateScoreMutation:u,teeTime:g}){const x=ne.getInstance(),[i,m]=h.useState(Date.now());h.useEffect(()=>{s==="score"&&t&&g&&D.handleInitialSync({teeTimeId:t,competitionId:n||"",activeTab:s,lastSyncTime:i,hasData:!!g,onSync:async()=>{await a(),m(Date.now())}})},[s,t,g,a,n,i]),h.useEffect(()=>{const c=async()=>{await D.handleVisibilityChangeSync({teeTimeId:t,competitionId:n||"",activeTab:s,lastSyncTime:i,isScoreEntry:s==="score",onSync:async()=>{await a(),m(Date.now())}})&&m(Date.now())};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[s,t,i,a,n]),h.useEffect(()=>{if(!t)return;const c=setInterval(async()=>{try{let S=!1;const P=x.getRetryableScores();if(P.length>0){console.log(`Retrying ${P.length} pending scores...`),S=!0;for(const b of P)try{await u.mutateAsync({participantId:b.participantId,hole:b.hole,shots:b.shots}),x.removePendingScore(b.participantId,b.hole)}catch(H){x.markAttempted(b.participantId,b.hole),console.error(`Retry failed for score ${b.participantId}-${b.hole}:`,H)}}D.shouldRetryPendingScores(P,i)&&(S||D.shouldSync(i,A.PERIODIC))&&(console.log("Syncing with server for latest scores..."),await a(),m(Date.now()))}catch(S){console.error("Sync validation failed:",S)}},A.PERIODIC);return()=>clearInterval(c)},[t,u,a,x,i]),h.useEffect(()=>{if(!n||!D.shouldRunPeriodicSync(s))return;const c=setInterval(async()=>{await D.handlePeriodicViewSync(s,async()=>{await r()},async()=>{await d()}),m(Date.now())},A.PERIODIC);return()=>clearInterval(c)},[s,n,r,d]),h.useEffect(()=>{(s==="leaderboard"||s==="teams")&&n&&D.handleInitialViewFetch(s,n,async()=>{await r()},async()=>{await d()})},[s,n,r,d]);const l=D.createSyncStatus(x,i),f=h.useCallback((c,S,P)=>{const b=parseInt(c);x.addPendingScore(b,S,P),u.mutate({participantId:b,hole:S,shots:P},{onSuccess:()=>{x.removePendingScore(b,S),m(Date.now()),console.log("Score update successful, cache invalidated automatically")},onError:H=>{console.error("Score update failed:",H)}})},[u,x]),k=h.useCallback(async c=>{await D.handleTabChangeSync({newTab:c,teeTimeId:t,competitionId:n||"",activeTab:c,lastSyncTime:i,onSync:async()=>{await a(),m(Date.now())},onLeaderboardSync:async()=>{await r(),m(Date.now())},onTeamsSync:async()=>{await d()}})},[t,n,i,a,r,d]),p=h.useCallback(async c=>{await D.handleHoleNavigationSync({currentHole:c,teeTimeId:t,competitionId:n||"",activeTab:s,lastSyncTime:i,onSync:async()=>{await a(),m(Date.now())}})&&m(Date.now())},[i,a,t,n,s]);return{syncStatus:l,handleScoreUpdate:f,handleTabChangeSync:k,handleHoleNavigationSync:p,lastSyncTime:i}}function yt(n){return n?{id:n.id.toString(),players:n.participants.map(t=>({participantId:t.id.toString(),participantName:t.team_name,participantType:Ve(t.position_name),isMultiPlayer:Me(t.position_name),scores:t.score,playerNames:t.player_names}))}:null}function gt(n){return n?{id:n.id,team_name:n.team_name,position_name:n.position_name,player_names:n.player_names,score:n.score,tee_time_id:n.tee_time_id}:null}const me=n=>`golf-current-hole-${n}`,bt=(n,t)=>{n&&t&&sessionStorage.setItem(me(n),t.toString())};function Nt({onNumberPress:n,onSpecialPress:t,onDismiss:s,visible:a,holePar:r,currentHole:d,playerName:u}){const g=l=>{n(l)},x=l=>{t(l)},i=()=>{s&&s()},m=l=>{if(l===1)return"HIO";const f=l-r;return f<=-4?"OTHER":f===-3?"ALBA":f===-2?"EAGLE":f===-1?"BIRDIE":f===0?"PAR":f===1?"BOGEY":f===2?"DOUBLE":f===3?"TRIPLE":f===4?"QUAD":f>=5?"OTHER":""};return a?e.jsxs("div",{className:C("fixed bottom-0 left-0 right-0 bg-scorecard border-t border-soft-grey transition-transform duration-300 ease-in-out z-50",a?"translate-y-0":"translate-y-full","shadow-lg rounded-t-xl"),children:[e.jsx("div",{className:"bg-turf text-scorecard px-4 py-2 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-lg font-bold font-display",children:["Hole ",d," | Par ",r]})})}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-soft-grey bg-rough bg-opacity-20",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm font-medium text-fairway font-primary",children:u||"Enter Score"})}),s&&e.jsx("button",{onMouseDown:l=>{l.preventDefault(),i()},className:"p-2 rounded-xl bg-rough bg-opacity-30 hover:bg-rough hover:bg-opacity-50 transition-colors touch-manipulation focus:outline-none","aria-label":"Close keyboard",children:e.jsx(re,{className:"w-5 h-5 text-fairway"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[1,2,3].map(l=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),g(l)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:l}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:m(l)})]},l))}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[4,5,6].map(l=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),g(l)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:l}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:m(l)})]},l))}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[[7,8].map(l=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),g(l)},className:"h-14 bg-rough bg-opacity-40 hover:bg-rough hover:bg-opacity-60 active:bg-rough active:bg-opacity-80 rounded-xl text-xl font-bold text-fairway transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:l}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:m(l)})]},l)),e.jsxs("button",{onMouseDown:l=>{l.preventDefault(),x("more")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"9+"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:m(9)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onMouseDown:l=>{l.preventDefault(),x("clear")},className:"h-14 bg-transparent border-2 border-flag text-flag hover:bg-flag/10 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"âˆ’"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"GAVE UP"})]}),e.jsxs("button",{onMouseDown:l=>{l.preventDefault(),x("unreported")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"0"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"CLEAR"})]})]})]})]}):null}function he({visible:n,teeTimeGroup:t,course:s,currentHole:a,onClose:r,onContinueEntry:d,onLockRound:u}){const[g,x]=h.useState(!1);return n?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:[e.jsxs("div",{className:C("bg-scorecard w-full max-h-[90vh] rounded-t-2xl transition-transform duration-300 ease-in-out border-t border-soft-grey","transform translate-y-0"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-soft-grey",children:[e.jsx("button",{onClick:r,className:"p-2 hover:bg-rough hover:bg-opacity-30 rounded-xl transition-colors",children:e.jsx(ue,{className:"h-5 w-5 text-fairway"})}),e.jsx("h2",{className:"text-lg font-semibold font-display text-fairway",children:"Full Scorecard"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors",children:e.jsx(re,{className:"h-5 w-5 text-flag"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsx("div",{className:"px-2 py-4 space-y-6",children:t.players.map(i=>e.jsx(Xe,{participant:{id:i.participantId,name:i.participantName,type:i.participantType,isMultiPlayer:i.isMultiPlayer,scores:i.scores},course:s,currentHole:a},i.participantId))})}),e.jsxs("div",{className:"p-4 border-t border-soft-grey space-y-3",children:[e.jsxs("button",{onClick:()=>d(a),className:"w-full bg-turf text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-fairway transition-colors font-primary",children:["Continue Entry on Hole ",a]}),u&&e.jsx("button",{onClick:()=>x(!0),className:"w-full bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize and Lock Round"})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-coral bg-opacity-20 rounded-full",children:e.jsx(Ke,{className:"w-6 h-6 text-coral"})}),e.jsx("h2",{className:"text-xl font-bold text-center font-display text-fairway mb-2",children:"Finalize Round"}),e.jsx("p",{className:"text-center text-charcoal mb-6 font-primary",children:"Are you sure you want to finalize and lock this round? This action cannot be undone and will prevent any further score changes."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 bg-soft-grey bg-opacity-30 text-charcoal py-3 px-4 rounded-xl font-medium hover:bg-soft-grey hover:bg-opacity-50 transition-colors font-primary",children:"Cancel"}),e.jsx("button",{onClick:()=>{x(!1),u==null||u()},className:"flex-1 bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize & Lock"})]})]})})})]}):null}function jt({onScoreSubmit:n,onCancel:t}){const[s,a]=h.useState(!1),[r,d]=h.useState(""),u=h.useCallback(()=>{a(!0),d("")},[]),g=h.useCallback(()=>{a(!1),d(""),t()},[t]),x=h.useCallback(()=>{const m=parseInt(r,10);!isNaN(m)&&m>=9&&(n(m),g())},[r,n,g]),i=h.useCallback(m=>{const l=m.target.value;/^\d*$/.test(l)&&d(l)},[]);return{isVisible:s,inputValue:r,show:u,hide:g,handleSubmit:x,handleInputChange:i}}function vt({teeTimeGroup:n,course:t,onScoreUpdate:s,onComplete:a,currentHole:r,onHoleChange:d,syncStatus:u,onPlayerNameClick:g,isReadyToFinalize:x=!1,onFinalize:i,isLocked:m=!1}){var U;const l=()=>{for(let o=17;o>=0;o--)if(n.players.some(w=>{const N=w.scores[o];return N&&N>0}))if(n.players.every(N=>{const E=N.scores[o];return E&&E!==0})){if(o<17)return o+2}else return o+1;return 1},[f,k]=h.useState(()=>l()),p=r!==void 0?r:f,[c,S]=h.useState(0),[P,b]=h.useState(!1),[H,M]=h.useState(!1),[B,K]=h.useState(!1),[Y,T]=h.useState(!1),{isVisible:J,inputValue:G,show:z,hide:W,handleSubmit:X,handleInputChange:q}=jt({onScoreSubmit:o=>{j&&(s(j.participantId,p,o),R())},onCancel:()=>{b(!0)}}),j=n.players[c],L=t.holes.find(o=>o.number===p),V=o=>{let v=0,w=0;for(let N=0;N<t.holes.length;N++){const E=o.scores[N];if(E===-1)return null;E&&E>0&&(v+=E,w+=t.holes[N].par)}return w===0?null:v-w},R=()=>{c<n.players.length-1?S(c+1):(T(!0),setTimeout(()=>{if(T(!1),p<18){const o=p+1;d?d(o):k(o),S(0)}else a()},800))},F=o=>{m||(S(o),b(!0),K(!0))},Q=o=>{m||j&&(s(j.participantId,p,o),R())},Z=o=>{if(!m){if(o==="more")b(!1),z();else if(o==="clear"){if(!j)return;s(j.participantId,p,-1),R()}else if(o==="unreported"){if(!j)return;s(j.participantId,p,0),R()}}},ee=()=>{b(!1),K(!1)},te=o=>{g&&g(o.participantId,o.playerNames||null,o.participantType||"")},se=o=>{const v=o.split(" ");if(v.length>=2){const w=v[0],N=v[1];return o.length<=14?o:w.length<=8?`${w} ${N.charAt(0)}.`:N.length<=8?`${w.charAt(0)}. ${N}`:`${w.charAt(0)}. ${N.charAt(0)}.`}return o.length>12?`${o.substring(0,11)}...`:o};return h.useEffect(()=>{const o=v=>{B&&!v.target.closest(".score-entry")&&(b(!1),K(!1))};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[B]),e.jsxs("div",{className:"score-entry flex flex-col h-screen-mobile bg-scorecard relative",children:[u&&(u.pendingCount>0||u.hasConnectivityIssues)&&e.jsx("div",{className:C("px-3 py-2 text-center text-xs font-medium",u.hasConnectivityIssues?"bg-flag text-scorecard border-b border-flag":"bg-coral text-scorecard border-b border-coral"),children:u.hasConnectivityIssues?e.jsxs("span",{children:["âš ï¸ Connection issues - ",u.pendingCount," score(s) pending"]}):e.jsxs("span",{children:["ðŸ“¡ Saving ",u.pendingCount," score(s)..."]})}),Y&&e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-turf text-scorecard px-6 py-4 rounded-xl shadow-lg z-30 animate-pulse",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold font-display",children:["âœ“ Hole ",p," Complete!"]}),e.jsxs("div",{className:"text-sm opacity-90 font-primary",children:["Moving to hole ",p+1,"..."]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{minHeight:"60%"},children:[e.jsx("div",{className:"bg-rough bg-opacity-30 px-4 py-2 border-b border-soft-grey",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center space-x-4 relative left-[50px]",children:[p>1&&e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:p-1}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par"," ",((U=t.holes.find(o=>o.number===p-1))==null?void 0:U.par)||4]})]}),e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:p}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par ",(L==null?void 0:L.par)||4]})]}),e.jsx("div",{className:"w-12 h-6 opacity-0"})]})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[n.players.map((o,v)=>{const w=v===c,N=o.scores[p-1]??0,E=p>1?o.scores[p-2]??0:null,$=V(o);return e.jsx("div",{className:C("bg-scorecard rounded-lg p-4 shadow-sm border transition-all duration-200",w?"border-coral/20 shadow-md ring-2 ring-coral/10":"border-soft-grey"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>te(o),className:"text-left w-full hover:bg-rough/10 rounded-md p-1 -m-1 transition-colors",children:o.playerNames?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:se(o.playerNames)}),e.jsxs("p",{className:"text-label-sm text-turf font-primary",children:[o.participantName," ",o.participantType]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:[o.participantName," ",o.participantType]}),e.jsxs("div",{className:"flex items-center gap-1 text-label-sm text-soft-grey font-primary",children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsx("span",{children:"+ Add player name"})]})]})}),e.jsx("span",{className:C("text-label-sm font-medium font-primary",$!==null?Qe($):"text-soft-grey"),children:$!==null?qe($):"-"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[p>1&&e.jsx("div",{className:"text-center w-12",children:e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:Ze(E||0)})}),e.jsx("button",{onClick:()=>F(v),disabled:m,className:C("w-12 h-12 rounded-full border-2 flex items-center justify-center text-label-sm font-medium touch-manipulation transition-colors",m?"border-soft-grey bg-soft-grey/20 cursor-not-allowed":"border-soft-grey bg-rough/10 text-turf hover:bg-rough/20"),children:e.jsx("span",{className:"text-lg font-bold text-fairway font-display",children:N>0?N:N===-1?"âˆ’":"0"})})]})]})},o.participantId)}),!x&&e.jsxs("button",{onClick:()=>M(!0),className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-lg transition-colors mt-6 flex items-center justify-center space-x-2 font-primary",children:[e.jsx(ze,{size:20}),e.jsx("span",{children:"View Full Scorecard"})]}),x&&!m&&e.jsx("div",{className:"bg-scorecard border-t border-soft-grey p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>M(!0),className:"flex-1 bg-turf hover:bg-fairway text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Review Scorecard"})}),e.jsx("button",{onClick:i,className:"flex-1 bg-coral hover:bg-orange-600 text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Complete Round"})})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-turf bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-turf text-3xl",children:"âœ“"})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 font-display text-fairway",children:"Round Complete!"}),e.jsx("p",{className:"text-charcoal font-primary mb-8 leading-relaxed",children:"Your round has been successfully finalized and locked. All scores have been submitted and the results are now official."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{const o=window.location.pathname.split("/"),v=o[o.indexOf("competitions")+1];window.location.href=`/player/competitions/${v}#leaderboard`},className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"View Leaderboard"}),e.jsx("button",{onClick:()=>{const o=window.location.pathname.split("/"),v=o[o.indexOf("competitions")+1];window.location.href=`/player/competitions/${v}`},className:"w-full bg-soft-grey bg-opacity-30 hover:bg-soft-grey hover:bg-opacity-50 text-charcoal font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"Back to Competition"})]})]})})})]})]}),!m&&e.jsx(Nt,{visible:P,onNumberPress:Q,onSpecialPress:Z,holePar:(L==null?void 0:L.par)||4,currentHole:p,onDismiss:ee,teeTimeGroup:n,course:t,playerName:(j==null?void 0:j.playerNames)||`${j==null?void 0:j.participantName} ${j==null?void 0:j.participantType}`}),e.jsx(he,{visible:H,teeTimeGroup:n,course:t,currentHole:p,onClose:()=>M(!1),onContinueEntry:o=>{k(o||p),S(0),M(!1)}}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm border border-soft-grey",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 font-display text-fairway",children:"Enter Score (9 or higher)"}),e.jsx("input",{type:"number",value:G,onChange:q,className:"w-full p-3 border-2 border-soft-grey rounded-xl mb-4 text-2xl text-center font-display text-charcoal focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors",placeholder:"Enter score",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:W,className:"flex-1 p-3 bg-rough bg-opacity-30 rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary text-fairway transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,className:"flex-1 p-3 bg-turf text-scorecard rounded-xl hover:bg-fairway font-medium font-primary transition-colors",children:"Submit"})]})]})})]})}Array.from({length:18},(n,t)=>({number:t+1,par:Math.floor(Math.random()*2)+3}));Array(18).fill(null),Array(18).fill(null),Array(18).fill(null),Array(18).fill(null);function St(n,t){return n?{id:n.id.toString(),name:t?t.name:`${n.course_name} ${n.teetime}`,holes:n.pars.map((s,a)=>({number:a+1,par:s}))}:null}function Et(){var ie;const{competitionId:n,teeTimeId:t}=Be({strict:!1}),s=()=>{if(t)return"score";const y=window.location.hash.replace("#","");return y==="teams"?"teams":y==="participants"?"participants":"leaderboard"},[a,r]=h.useState(s),[d,u]=h.useState(null),[g,x]=h.useState(null),[i,m]=h.useState(()=>{if(t){const y=me(t),I=sessionStorage.getItem(y);if(I){const _=parseInt(I,10);if(_>=1&&_<=18)return _}}return 1}),{competition:l,course:f,teeTimes:k,leaderboard:p,teeTime:c,selectedParticipant:S,isLoading:P,leaderboardLoading:b,refetchTeeTime:H,refetchLeaderboard:M,refetchTeeTimes:B,updateScoreMutation:K}=xt({competitionId:n,teeTimeId:t,selectedParticipantId:d}),{syncStatus:Y,handleScoreUpdate:T,handleTabChangeSync:J,handleHoleNavigationSync:G}=pt({competitionId:n,teeTimeId:t,activeTab:a,refetchTeeTime:H,refetchLeaderboard:M,refetchTeeTimes:B,updateScoreMutation:K,teeTime:c}),{data:z}=Te((l==null?void 0:l.series_id)||0),W=Ge(),X=Ue(),[q,j]=h.useState(!1),[L,V]=h.useState(!1);h.useEffect(()=>{t&&i&&bt(t,i)},[t,i]),h.useEffect(()=>{if(c!=null&&c.participants&&c.participants.length>0)if(c.participants.filter(I=>Array.isArray(I.score)).length===c.participants.length){const I=et(c.participants);j(I)}else j(!1);else j(!1)},[c]);const R=yt(c),F=St(c,f),Q=gt(S||null),Z=c&&f?{id:f.id.toString(),name:f.name,holes:c.pars.map((y,I)=>({number:I+1,par:y}))}:null,ee=async y=>{r(y),await J(y)},te=y=>{u(y)},se=()=>{u(null)},U=()=>{console.log("Score entry completed!")},o=(y,I,_)=>{x({id:y,currentName:I,positionName:_})},v=()=>{x(null)},w=(y,I)=>{W.mutate({id:parseInt(y),data:{player_names:I}},{onSuccess:()=>{x(null)},onError:_=>{console.error("Failed to update participant name:",_)}})},N=h.useCallback(async y=>{m(y),await G(y)},[G]),E=p?tt(st(p.map(y=>({...y,participantId:y.participant.id}))),z==null?void 0:z.length):[],$=at(k),oe=F==null?void 0:F.holes.find(y=>y.number===i),fe=()=>{V(!0)},xe=()=>{c!=null&&c.participants&&(c.participants.forEach(y=>{X.mutate(y.id)}),V(!1))},pe=((ie=c==null?void 0:c.participants)==null?void 0:ie.some(y=>y.is_locked))||!1;if(P)return e.jsx("div",{className:"p-4",children:"Loading competition..."});if(!l)return e.jsx("div",{className:"p-4",children:"Competition not found"});const ye=()=>{switch(a){case"score":return!R||!F?e.jsx(wt,{teeTimes:k||[],competitionId:n||""}):e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(vt,{teeTimeGroup:R,course:F,onScoreUpdate:T,onComplete:U,currentHole:i,onHoleChange:N,syncStatus:Y,onPlayerNameClick:o,isReadyToFinalize:q,onFinalize:fe,isLocked:pe})})});case"leaderboard":return e.jsx(lt,{leaderboard:p,leaderboardLoading:b,onParticipantClick:te,isRoundView:!0});case"teams":return e.jsx(it,{teamResults:E,leaderboardLoading:b,isRoundView:!0});case"participants":return e.jsx(ot,{teeTimes:k,teeTimesLoading:!1,competitionId:n||"",currentTeeTimeId:t,currentTeeTime:c,showCurrentGroup:!0,totalParticipants:$});default:return null}};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(Ye,{title:l.name,seriesId:l.series_id,seriesName:l.series_name,children:e.jsx(nt,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:ye()}),a==="score"&&oe&&e.jsx(mt,{currentHole:i,holePar:oe.par,onPrevious:()=>N(Math.max(1,i-1)),onNext:()=>N(Math.min(18,i+1)),canGoPrevious:i>1,canGoNext:i<18,className:"flex-shrink-0"}),e.jsx(ut,{activeTab:a,onTabChange:ee,className:"flex-shrink-0"}),e.jsx(ht,{competition:l,courseName:f==null?void 0:f.name,totalParticipants:$,variant:"footer"}),e.jsx(rt,{visible:d!==null,participant:Q,course:Z,onClose:se}),e.jsx(ft,{isOpen:g!==null,onClose:v,onSave:w,participant:g}),e.jsx(he,{visible:L,teeTimeGroup:R||{id:"",players:[]},course:F||{id:"",name:"",holes:[]},currentHole:i,onClose:()=>V(!1),onContinueEntry:()=>V(!1),onLockRound:xe})]})}function wt({teeTimes:n,competitionId:t}){const s=Je();return e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"Select Tee Time for Score Entry"})}),!n||n.length===0?e.jsx("div",{className:"text-center py-6 md:py-8 text-gray-500",children:"No tee times available for this competition."}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(a=>e.jsx("button",{onClick:()=>s({to:`/player/competitions/${t}/tee-times/${a.id}`,replace:!0}),className:"w-full px-4 md:px-6 py-3 md:py-4 text-left hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm md:text-lg font-medium text-gray-900",children:a.teetime}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 mt-1",children:a.participants.map(r=>r.team_name).join(", ")})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.participants.length," player",a.participants.length!==1?"s":""]})]})},a.id))})})]})})}export{Et as default};
