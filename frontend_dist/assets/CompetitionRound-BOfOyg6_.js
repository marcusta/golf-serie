var Ne=Object.defineProperty;var je=(a,t,s)=>t in a?Ne(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var ce=(a,t,s)=>je(a,typeof t!="symbol"?t+"":t,s);import{q as ve,j as e,s as I,a as we,p as Se,U as ue,t as me,C as Ce,m as Ie,n as Pe,r as m,R as Ee,P as ke,v as De,w as Ae,x as Le,y as Re,X as re,d as Fe,e as He,g as $e,h as _e,i as Oe,z as Ve,k as Me,B as Ke,D as ze,E as Be,F as Te,G as Ge,b as Ue,f as Ye,H as Je,I as We,l as Xe,J as qe}from"./index-BqyBPHIQ.js";import{P as Qe,S as Ze,f as et,g as tt,d as st,i as at,c as nt,H as rt,b as ot,a as it,T as lt,L as ct}from"./TeamResultComponent-B5J_s8W_.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ut=ve("pencil",dt);function mt({activeTab:a,onTabChange:t,className:s}){const n=[{id:"score",label:"Score Entry",shortLabel:"Score",icon:Qe,disabled:!1},{id:"leaderboard",label:"Leaderboard",shortLabel:"Leaderboard",icon:we,disabled:!1},{id:"teams",label:"Team Results",shortLabel:"Teams",icon:Se,disabled:!1},{id:"participants",label:"Participants",shortLabel:"Start List",icon:ue,disabled:!1}];return e.jsx("div",{className:I("bg-scorecard border-t-2 border-soft-grey shadow-[0_-2px_8px_rgba(27,67,50,0.08)]",s),children:e.jsx("div",{className:"grid grid-cols-4 max-w-lg mx-auto",children:n.map(o=>{const d=a===o.id,u=o.icon;return e.jsxs("button",{onClick:()=>!o.disabled&&t(o.id),disabled:o.disabled,className:I("flex flex-col items-center justify-center py-3 px-2 transition-all duration-200 touch-manipulation","min-h-[60px] md:min-h-[64px] font-['Inter']",d?"text-coral bg-gradient-to-b from-coral/10 to-coral/5 border-t-2 border-coral":"text-charcoal hover:text-turf hover:bg-rough/30",o.disabled&&"opacity-50 cursor-not-allowed"),children:[e.jsx(u,{className:I("mb-1 transition-all duration-200",d?"w-6 h-6":"w-5 h-5","md:w-6 md:h-6")}),e.jsxs("span",{className:I("text-xs font-medium transition-all duration-200","md:text-sm",d&&"font-semibold"),children:[e.jsx("span",{className:"sm:hidden",children:o.shortLabel}),e.jsx("span",{className:"hidden sm:inline",children:o.label})]})]},o.id)})})})}function ft({currentHole:a,holePar:t,holeHcp:s,onPrevious:n,onNext:o,canGoPrevious:d,canGoNext:u,className:x}){return e.jsx("div",{className:I("bg-coral text-charcoal px-4 py-2","shadow-lg border-t border-coral/20",x),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,disabled:!d,className:I("p-2 rounded-lg transition-all duration-200 touch-manipulation",d?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(me,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-8 text-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Par"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:t})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Holes"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:a})]}),s!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"HCP"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:s})]})]}),e.jsx("button",{onClick:o,disabled:!u,className:I("p-2 rounded-lg transition-all duration-200 touch-manipulation",u?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(Ce,{className:"w-6 h-6"})})]})})}function ht({competition:a,courseName:t,totalParticipants:s,variant:n="footer"}){const o=n==="header"?"bg-rough/30 rounded-xl p-4 border border-soft-grey":"bg-rough/30 border-t border-soft-grey px-4 py-2 flex-shrink-0";return e.jsx("div",{className:o,children:e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-8 text-label-sm text-charcoal font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ie,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(a.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(a.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"truncate",children:t||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ue,{className:"h-4 w-4 text-turf"}),e.jsxs("span",{children:[s," participants"]})]})]})})}function xt({isOpen:a,onClose:t,onSave:s,participant:n}){const[o,d]=m.useState("");m.useEffect(()=>{n&&d(n.currentName||"")},[n]);const u=()=>{if(!n)return;const l=o.trim();l.length!==0&&s(n.id,l)},x=()=>{d((n==null?void 0:n.currentName)||""),t()},g=l=>{l.key==="Enter"?(l.preventDefault(),u()):l.key==="Escape"&&(l.preventDefault(),x())};return n?e.jsx(Ee,{open:a,onOpenChange:t,children:e.jsxs(ke,{children:[e.jsx(De,{className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsx(Ae,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm shadow-xl border border-soft-grey max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Le,{className:"text-lg font-semibold text-fairway font-display",children:"Edit Player Name"}),e.jsx(Re,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors","aria-label":"Close",children:e.jsx(re,{className:"h-4 w-4 text-flag"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-turf font-primary",children:["Editing position:"," ",e.jsx("span",{className:"font-medium",children:n.positionName})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"player-name",className:"block text-sm font-medium text-charcoal mb-2 font-primary",children:"Player Name"}),e.jsx("input",{id:"player-name",type:"text",value:o,onChange:l=>d(l.target.value),onKeyDown:g,className:"w-full p-3 border-2 border-soft-grey rounded-xl text-charcoal font-primary focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors outline-none",placeholder:"Enter player name",autoFocus:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:x,className:"flex-1 p-3 bg-rough bg-opacity-30 text-fairway rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:o.trim().length===0,className:I("flex-1 p-3 rounded-xl font-medium font-primary transition-colors",o.trim().length>0?"bg-turf text-scorecard hover:bg-fairway":"bg-soft-grey text-soft-grey cursor-not-allowed"),children:"Save"})]})]})})]})}):null}function pt({competitionId:a,teeTimeId:t,selectedParticipantId:s}){const{data:n,isLoading:o}=Fe(a?parseInt(a):0),{data:d}=He((n==null?void 0:n.course_id)||0),{data:u,refetch:x}=$e(a?parseInt(a):0),{data:g,isLoading:l,refetch:f}=_e(a?parseInt(a):0),i=g,{data:h,isLoading:k,refetch:p}=Oe(a?parseInt(a):0),{data:D,refetch:c}=Ve(t?parseInt(t):0),{data:S}=Me(s||0),w=Ke();return{competition:n,course:d,teeTimes:u,leaderboard:i,teamLeaderboard:h,teeTime:D,selectedParticipant:S,isLoading:o,leaderboardLoading:l,teamLeaderboardLoading:k,refetchTeeTime:c,refetchLeaderboard:f,refetchTeamLeaderboard:p,refetchTeeTimes:x,updateScoreMutation:w}}const ae="golf-pending-scores",de=3,_=class _{constructor(){}static getInstance(){return _.instance||(_.instance=new _),_.instance}addPendingScore(t,s,n){const o=this.getPendingScores(),d=`${t}-${s}`;o[d]={participantId:t,hole:s,shots:n,timestamp:Date.now(),attempts:0},this.savePendingScores(o)}removePendingScore(t,s){const n=this.getPendingScores(),o=`${t}-${s}`;delete n[o],this.savePendingScores(n)}getPendingScores(){try{const t=localStorage.getItem(ae);return t?JSON.parse(t):{}}catch{return{}}}getPendingScoresArray(){const t=this.getPendingScores();return Object.values(t)}getPendingCount(){return this.getPendingScoresArray().length}markAttempted(t,s){const n=this.getPendingScores(),o=`${t}-${s}`;return n[o]?(n[o].attempts+=1,n[o].attempts>=de&&delete n[o],this.savePendingScores(n),!!n[o]):!1}clearPendingScores(){localStorage.removeItem(ae)}getRetryableScores(){return this.getPendingScoresArray().filter(t=>t.attempts<de)}hasConnectivityIssues(){const t=this.getPendingScoresArray(),s=Math.min(...t.map(n=>n.timestamp));return t.length>0&&Date.now()-s>3e4}savePendingScores(t){try{localStorage.setItem(ae,JSON.stringify(t))}catch(s){console.error("Failed to save pending scores to localStorage:",s)}}};ce(_,"instance");let ne=_;const L={TAB_CHANGE:15e3,VISIBILITY_CHANGE:6e4,PERIODIC:3e4,HOLE_NAVIGATION:2e4,INITIAL_FETCH:1e4};class ${static shouldSync(t,s){return Date.now()-t>s}static getSessionKey(t,s){return`golf-sync-${t}-${s}`}static needsInitialSync(t){return!sessionStorage.getItem(t)}static markSyncCompleted(t){sessionStorage.setItem(t,Date.now().toString())}static async handleInitialSync(t){if(!t.teeTimeId||!t.hasData)return!1;const s=this.getSessionKey("initial",t.teeTimeId);return this.needsInitialSync(s)?(console.log("Initial sync for score entry session..."),await t.onSync(),this.markSyncCompleted(s),!0):!1}static async handleTabChangeSync(t){const{newTab:s,teeTimeId:n,lastSyncTime:o}=t;s==="score"&&n&&this.shouldSync(o,L.TAB_CHANGE)&&(console.log("Syncing on tab change to score entry..."),await t.onSync()),(s==="leaderboard"||s==="teams")&&(console.log(`Syncing data for ${s} view...`),t.onLeaderboardSync&&await t.onLeaderboardSync(),s==="teams"&&t.onTeamsSync&&await t.onTeamsSync())}static async handleVisibilityChangeSync(t){return document.hidden||!t.isScoreEntry||!t.teeTimeId?!1:this.shouldSync(t.lastSyncTime,L.VISIBILITY_CHANGE)?(console.log("Syncing after returning to tab..."),await t.onSync(),!0):!1}static shouldSyncOnHoleChange(t,s){return t%3===1&&this.shouldSync(s,L.HOLE_NAVIGATION)}static async handleHoleNavigationSync(t){return t.teeTimeId&&this.shouldSyncOnHoleChange(t.currentHole,t.lastSyncTime)?(console.log(`Syncing on hole navigation to hole ${t.currentHole}...`),await t.onSync(),!0):!1}static needsInitialFetch(t,s){const n=`lastFetch-${t}-${s}`,o=sessionStorage.getItem(n);return(o?Date.now()-parseInt(o):1/0)>L.INITIAL_FETCH}static markInitialFetchCompleted(t,s){const n=`lastFetch-${t}-${s}`;sessionStorage.setItem(n,Date.now().toString())}static async handleInitialViewFetch(t,s,n,o){return this.needsInitialFetch(t,s)?(console.log(`Initial fetch for ${t} view...`),await n(),t==="teams"&&o&&await o(),this.markInitialFetchCompleted(t,s),!0):!1}static createSyncStatus(t,s){const n=t.getPendingCount();return{pendingCount:n,lastSyncTime:s,isOnline:navigator.onLine,hasConnectivityIssues:n>0&&Date.now()-s>L.PERIODIC}}static shouldRunPeriodicSync(t){return t==="leaderboard"||t==="teams"}static async handlePeriodicViewSync(t,s,n){this.shouldRunPeriodicSync(t)&&(console.log(`Periodic sync for ${t} view...`),await s(),t==="teams"&&n&&await n())}static shouldRetryPendingScores(t,s){return t.length>0||this.shouldSync(s,L.PERIODIC)}}function gt({competitionId:a,teeTimeId:t,activeTab:s,refetchTeeTime:n,refetchLeaderboard:o,refetchTeamLeaderboard:d,refetchTeeTimes:u,updateScoreMutation:x,teeTime:g}){const l=ne.getInstance(),[f,i]=m.useState(Date.now());m.useEffect(()=>{s==="score"&&t&&g&&$.handleInitialSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:f,hasData:!!g,onSync:async()=>{await n(),i(Date.now())}})},[s,t,g,n,a,f]),m.useEffect(()=>{const c=async()=>{await $.handleVisibilityChangeSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:f,isScoreEntry:s==="score",onSync:async()=>{await n(),i(Date.now())}})&&i(Date.now())};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[s,t,f,n,a]),m.useEffect(()=>{if(!t)return;const c=setInterval(async()=>{try{let S=!1;const w=l.getRetryableScores();if(w.length>0){console.log(`Retrying ${w.length} pending scores...`),S=!0;for(const j of w)try{await x.mutateAsync({participantId:j.participantId,hole:j.hole,shots:j.shots}),l.removePendingScore(j.participantId,j.hole)}catch(A){l.markAttempted(j.participantId,j.hole),console.error(`Retry failed for score ${j.participantId}-${j.hole}:`,A)}}$.shouldRetryPendingScores(w,f)&&(S||$.shouldSync(f,L.PERIODIC))&&(console.log("Syncing with server for latest scores..."),await n(),i(Date.now()))}catch(S){console.error("Sync validation failed:",S)}},L.PERIODIC);return()=>clearInterval(c)},[t,x,n,l,f]),m.useEffect(()=>{if(!a||!$.shouldRunPeriodicSync(s))return;const c=setInterval(async()=>{await $.handlePeriodicViewSync(s,async()=>{await o(),d&&await d()},async()=>{await u()}),i(Date.now())},L.PERIODIC);return()=>clearInterval(c)},[s,a,o,d,u]),m.useEffect(()=>{(s==="leaderboard"||s==="teams")&&a&&$.handleInitialViewFetch(s,a,async()=>{await o(),d&&await d()},async()=>{await u()})},[s,a,o,d,u]);const h=$.createSyncStatus(l,f),k=m.useCallback((c,S,w)=>{const j=parseInt(c);l.addPendingScore(j,S,w),x.mutate({participantId:j,hole:S,shots:w},{onSuccess:()=>{l.removePendingScore(j,S),i(Date.now())},onError:A=>{console.error("Score update failed:",A),l.markAttempted(j,S)}})},[x,l]),p=m.useCallback(async c=>{(c==="leaderboard"||c==="teams")&&(await o(),d&&await d()),(c==="teams"||c==="participants")&&await u(),i(Date.now())},[o,d,u]),D=m.useCallback(async()=>{t&&(await n(),i(Date.now()))},[n,t]);return{syncStatus:h,handleScoreUpdate:k,handleTabChangeSync:p,handleHoleNavigationSync:D}}function yt(a){return a?{id:a.id.toString(),players:a.participants.map(t=>({participantId:t.id.toString(),participantName:t.team_name,participantType:Be(t.position_name),isMultiPlayer:ze(t.position_name),scores:t.score,playerNames:t.player_names}))}:null}function bt(a){return a?{id:a.id,team_name:a.team_name,position_name:a.position_name,player_names:a.player_names,score:a.score,tee_time_id:a.tee_time_id}:null}const fe=a=>`golf-current-hole-${a}`,Nt=(a,t)=>{a&&t&&sessionStorage.setItem(fe(a),t.toString())};function jt({onNumberPress:a,onSpecialPress:t,onDismiss:s,visible:n,holePar:o,currentHole:d,playerName:u}){const x=i=>{a(i)},g=i=>{t(i)},l=()=>{s&&s()},f=i=>{if(i===1)return"HIO";const h=i-o;return h<=-4?"OTHER":h===-3?"ALBA":h===-2?"EAGLE":h===-1?"BIRDIE":h===0?"PAR":h===1?"BOGEY":h===2?"DOUBLE":h===3?"TRIPLE":h===4?"QUAD":h>=5?"OTHER":""};return n?e.jsxs("div",{className:I("fixed bottom-0 left-0 right-0 bg-scorecard border-t border-soft-grey transition-transform duration-300 ease-in-out z-50",n?"translate-y-0":"translate-y-full","shadow-lg rounded-t-xl"),children:[e.jsx("div",{className:"bg-turf text-scorecard px-4 py-2 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-lg font-bold font-display",children:["Hole ",d," | Par ",o]})})}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-soft-grey bg-rough bg-opacity-20",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm font-medium text-fairway font-primary",children:u||"Enter Score"})}),s&&e.jsx("button",{onMouseDown:i=>{i.preventDefault(),l()},className:"p-2 rounded-xl bg-rough bg-opacity-30 hover:bg-rough hover:bg-opacity-50 transition-colors touch-manipulation focus:outline-none","aria-label":"Close keyboard",children:e.jsx(re,{className:"w-5 h-5 text-fairway"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[1,2,3].map(i=>e.jsxs("button",{onMouseDown:h=>{h.preventDefault(),x(i)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:f(i)})]},i))}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[4,5,6].map(i=>e.jsxs("button",{onMouseDown:h=>{h.preventDefault(),x(i)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:f(i)})]},i))}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[[7,8].map(i=>e.jsxs("button",{onMouseDown:h=>{h.preventDefault(),x(i)},className:"h-14 bg-rough bg-opacity-40 hover:bg-rough hover:bg-opacity-60 active:bg-rough active:bg-opacity-80 rounded-xl text-xl font-bold text-fairway transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:f(i)})]},i)),e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),g("more")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"9+"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:f(9)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),g("clear")},className:"h-14 bg-transparent border-2 border-flag text-flag hover:bg-flag/10 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"−"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"GAVE UP"})]}),e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),g("unreported")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"0"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"CLEAR"})]})]})]})]}):null}function he({visible:a,teeTimeGroup:t,course:s,currentHole:n,onClose:o,onContinueEntry:d,onLockRound:u}){const[x,g]=m.useState(!1);return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:[e.jsxs("div",{className:I("bg-scorecard w-full max-h-[90vh] rounded-t-2xl transition-transform duration-300 ease-in-out border-t border-soft-grey","transform translate-y-0"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-soft-grey",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-rough hover:bg-opacity-30 rounded-xl transition-colors",children:e.jsx(me,{className:"h-5 w-5 text-fairway"})}),e.jsx("h2",{className:"text-lg font-semibold font-display text-fairway",children:"Full Scorecard"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors",children:e.jsx(re,{className:"h-5 w-5 text-flag"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsx("div",{className:"px-2 py-4 space-y-6",children:t.players.map(l=>e.jsx(Ze,{participant:{id:l.participantId,name:l.participantName,type:l.participantType,isMultiPlayer:l.isMultiPlayer,scores:l.scores},course:s,currentHole:n},l.participantId))})}),e.jsxs("div",{className:"p-4 border-t border-soft-grey space-y-3",children:[e.jsxs("button",{onClick:()=>d(n),className:"w-full bg-turf text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-fairway transition-colors font-primary",children:["Continue Entry on Hole ",n]}),u&&e.jsx("button",{onClick:()=>g(!0),className:"w-full bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize and Lock Round"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-coral bg-opacity-20 rounded-full",children:e.jsx(Te,{className:"w-6 h-6 text-coral"})}),e.jsx("h2",{className:"text-xl font-bold text-center font-display text-fairway mb-2",children:"Finalize Round"}),e.jsx("p",{className:"text-center text-charcoal mb-6 font-primary",children:"Are you sure you want to finalize and lock this round? This action cannot be undone and will prevent any further score changes."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 bg-soft-grey bg-opacity-30 text-charcoal py-3 px-4 rounded-xl font-medium hover:bg-soft-grey hover:bg-opacity-50 transition-colors font-primary",children:"Cancel"}),e.jsx("button",{onClick:()=>{g(!1),u==null||u()},className:"flex-1 bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize & Lock"})]})]})})})]}):null}function vt({onScoreSubmit:a,onCancel:t}){const[s,n]=m.useState(!1),[o,d]=m.useState(""),u=m.useCallback(()=>{n(!0),d("")},[]),x=m.useCallback(()=>{n(!1),d(""),t()},[t]),g=m.useCallback(()=>{const f=parseInt(o,10);!isNaN(f)&&f>=9&&(a(f),x())},[o,a,x]),l=m.useCallback(f=>{const i=f.target.value;/^\d*$/.test(i)&&d(i)},[]);return{isVisible:s,inputValue:o,show:u,hide:x,handleSubmit:g,handleInputChange:l}}function wt({teeTimeGroup:a,course:t,onScoreUpdate:s,onComplete:n,currentHole:o,onHoleChange:d,syncStatus:u,onPlayerNameClick:x,isReadyToFinalize:g=!1,onFinalize:l,isLocked:f=!1}){var Y;const i=()=>{for(let r=17;r>=0;r--)if(a.players.some(C=>{const b=C.scores[r];return b&&b>0}))if(a.players.every(b=>{const E=b.scores[r];return E&&E!==0})){if(r<17)return r+2}else return r+1;return 1},[h,k]=m.useState(()=>i()),p=o!==void 0?o:h,[D,c]=m.useState(0),[S,w]=m.useState(!1),[j,A]=m.useState(!1),[M,K]=m.useState(!1),[J,G]=m.useState(!1),{isVisible:W,inputValue:X,show:q,hide:Q,handleSubmit:U,handleInputChange:Z}=vt({onScoreSubmit:r=>{N&&(s(N.participantId,p,r),O())},onCancel:()=>{w(!0)}}),N=a.players[D],R=t.holes.find(r=>r.number===p),z=r=>{let v=0,C=0;for(let b=0;b<t.holes.length;b++){const E=r.scores[b];if(E===-1)return null;E&&E>0&&(v+=E,C+=t.holes[b].par)}return C===0?null:v-C},O=()=>{D<a.players.length-1?c(D+1):(G(!0),setTimeout(()=>{if(G(!1),p<18){const r=p+1;d?d(r):k(r),c(0)}else n()},800))},V=r=>{f||(c(r),w(!0),K(!0))},B=r=>{f||N&&(s(N.participantId,p,r),O())},F=r=>{if(!f){if(r==="more")w(!1),q();else if(r==="clear"){if(!N)return;s(N.participantId,p,-1),O()}else if(r==="unreported"){if(!N)return;s(N.participantId,p,0),O()}}},ee=()=>{w(!1),K(!1)},te=r=>{x&&x(r.participantId,r.playerNames||null,r.participantType||"")},se=r=>{const v=r.split(" ");if(v.length>=2){const C=v[0],b=v[1];return r.length<=14?r:C.length<=8?`${C} ${b.charAt(0)}.`:b.length<=8?`${C.charAt(0)}. ${b}`:`${C.charAt(0)}. ${b.charAt(0)}.`}return r.length>12?`${r.substring(0,11)}...`:r};return m.useEffect(()=>{const r=v=>{M&&!v.target.closest(".score-entry")&&(w(!1),K(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[M]),e.jsxs("div",{className:"score-entry flex flex-col h-screen-mobile bg-scorecard relative",children:[u&&(u.pendingCount>0||u.hasConnectivityIssues)&&e.jsx("div",{className:I("px-3 py-2 text-center text-xs font-medium",u.hasConnectivityIssues?"bg-flag text-scorecard border-b border-flag":"bg-coral text-scorecard border-b border-coral"),children:u.hasConnectivityIssues?e.jsxs("span",{children:["⚠️ Connection issues - ",u.pendingCount," score(s) pending"]}):e.jsxs("span",{children:["📡 Saving ",u.pendingCount," score(s)..."]})}),J&&e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-turf text-scorecard px-6 py-4 rounded-xl shadow-lg z-30 animate-pulse",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold font-display",children:["✓ Hole ",p," Complete!"]}),e.jsxs("div",{className:"text-sm opacity-90 font-primary",children:["Moving to hole ",p+1,"..."]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{minHeight:"60%"},children:[e.jsx("div",{className:"bg-rough bg-opacity-30 px-4 py-2 border-b border-soft-grey",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center space-x-4 relative left-[50px]",children:[p>1&&e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:p-1}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par"," ",((Y=t.holes.find(r=>r.number===p-1))==null?void 0:Y.par)||4]})]}),e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:p}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par ",(R==null?void 0:R.par)||4]})]}),e.jsx("div",{className:"w-12 h-6 opacity-0"})]})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[a.players.map((r,v)=>{const C=v===D,b=r.scores[p-1]??0,E=p>1?r.scores[p-2]??0:null,H=z(r);return e.jsx("div",{className:I("bg-scorecard rounded-lg p-4 shadow-sm border transition-all duration-200",C?"border-coral/20 shadow-md ring-2 ring-coral/10":"border-soft-grey"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>te(r),className:"text-left w-full hover:bg-rough/10 rounded-md p-1 -m-1 transition-colors",children:r.playerNames?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:se(r.playerNames)}),e.jsxs("p",{className:"text-label-sm text-turf font-primary",children:[r.participantName," ",r.participantType]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:[r.participantName," ",r.participantType]}),e.jsxs("div",{className:"flex items-center gap-1 text-label-sm text-soft-grey font-primary",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsx("span",{children:"+ Add player name"})]})]})}),e.jsx("span",{className:I("text-label-sm font-medium font-primary",H!==null?tt(H):"text-soft-grey"),children:H!==null?et(H):"-"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[p>1&&e.jsx("div",{className:"text-center w-12",children:e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:st(E||0)})}),e.jsx("button",{onClick:()=>V(v),disabled:f,className:I("w-12 h-12 rounded-full border-2 flex items-center justify-center text-label-sm font-medium touch-manipulation transition-colors",f?"border-soft-grey bg-soft-grey/20 cursor-not-allowed":"border-soft-grey bg-rough/10 text-turf hover:bg-rough/20"),children:e.jsx("span",{className:"text-lg font-bold text-fairway font-display",children:b>0?b:b===-1?"−":"0"})})]})]})},r.participantId)}),!g&&e.jsxs("button",{onClick:()=>A(!0),className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-lg transition-colors mt-6 flex items-center justify-center space-x-2 font-primary",children:[e.jsx(Ge,{size:20}),e.jsx("span",{children:"View Full Scorecard"})]}),g&&!f&&e.jsx("div",{className:"bg-scorecard border-t border-soft-grey p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>A(!0),className:"flex-1 bg-turf hover:bg-fairway text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Review Scorecard"})}),e.jsx("button",{onClick:l,className:"flex-1 bg-coral hover:bg-orange-600 text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Complete Round"})})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-turf bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-turf text-3xl",children:"✓"})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 font-display text-fairway",children:"Round Complete!"}),e.jsx("p",{className:"text-charcoal font-primary mb-8 leading-relaxed",children:"Your round has been successfully finalized and locked. All scores have been submitted and the results are now official."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{const r=window.location.pathname.split("/"),v=r[r.indexOf("competitions")+1];window.location.href=`/player/competitions/${v}#leaderboard`},className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"View Leaderboard"}),e.jsx("button",{onClick:()=>{const r=window.location.pathname.split("/"),v=r[r.indexOf("competitions")+1];window.location.href=`/player/competitions/${v}`},className:"w-full bg-soft-grey bg-opacity-30 hover:bg-soft-grey hover:bg-opacity-50 text-charcoal font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"Back to Competition"})]})]})})})]})]}),!f&&e.jsx(jt,{visible:S,onNumberPress:B,onSpecialPress:F,holePar:(R==null?void 0:R.par)||4,currentHole:p,onDismiss:ee,teeTimeGroup:a,course:t,playerName:(N==null?void 0:N.playerNames)||`${N==null?void 0:N.participantName} ${N==null?void 0:N.participantType}`}),e.jsx(he,{visible:j,teeTimeGroup:a,course:t,currentHole:p,onClose:()=>A(!1),onContinueEntry:r=>{k(r||p),c(0),A(!1)}}),W&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm border border-soft-grey",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 font-display text-fairway",children:"Enter Score (9 or higher)"}),e.jsx("input",{type:"number",value:X,onChange:Z,className:"w-full p-3 border-2 border-soft-grey rounded-xl mb-4 text-2xl text-center font-display text-charcoal focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors",placeholder:"Enter score",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Q,className:"flex-1 p-3 bg-rough bg-opacity-30 rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary text-fairway transition-colors",children:"Cancel"}),e.jsx("button",{onClick:U,className:"flex-1 p-3 bg-turf text-scorecard rounded-xl hover:bg-fairway font-medium font-primary transition-colors",children:"Submit"})]})]})})]})}Array.from({length:18},(a,t)=>({number:t+1,par:Math.floor(Math.random()*2)+3}));Array(18).fill(null),Array(18).fill(null),Array(18).fill(null),Array(18).fill(null);function St(a,t){return a?{id:a.id.toString(),name:t?t.name:`${a.course_name} ${a.teetime}`,holes:a.pars.map((s,n)=>({number:n+1,par:s}))}:null}function kt(){var le;const{competitionId:a,teeTimeId:t}=Ue({strict:!1}),s=()=>{if(t)return"score";const y=window.location.hash.replace("#","");return y==="teams"?"teams":y==="participants"?"participants":"leaderboard"},[n,o]=m.useState(s),[d,u]=m.useState(null),[x,g]=m.useState(null),[l,f]=m.useState(()=>{if(t){const y=fe(t),P=sessionStorage.getItem(y);if(P){const T=parseInt(P,10);if(T>=1&&T<=18)return T}}return 1}),{competition:i,course:h,teeTimes:k,leaderboard:p,teamLeaderboard:D,teeTime:c,selectedParticipant:S,isLoading:w,leaderboardLoading:j,teamLeaderboardLoading:A,refetchTeeTime:M,refetchLeaderboard:K,refetchTeamLeaderboard:J,refetchTeeTimes:G,updateScoreMutation:W}=pt({competitionId:a,teeTimeId:t,selectedParticipantId:d}),{syncStatus:X,handleScoreUpdate:q,handleTabChangeSync:Q,handleHoleNavigationSync:U}=gt({competitionId:a,teeTimeId:t,activeTab:n,refetchTeeTime:M,refetchLeaderboard:K,refetchTeamLeaderboard:J,refetchTeeTimes:G,updateScoreMutation:W,teeTime:c});Ye((i==null?void 0:i.series_id)||0);const Z=Je(),N=We(),[R,z]=m.useState(!1),[O,V]=m.useState(!1);m.useEffect(()=>{t&&l&&Nt(t,l)},[t,l]),m.useEffect(()=>{if(c!=null&&c.participants&&c.participants.length>0)if(c.participants.filter(P=>Array.isArray(P.score)).length===c.participants.length){const P=at(c.participants);z(P)}else z(!1);else z(!1)},[c]);const B=yt(c),F=St(c,h),ee=bt(S||null),te=c&&h?{id:h.id.toString(),name:h.name,holes:c.pars.map((y,P)=>({number:P+1,par:y}))}:null,se=async y=>{o(y),await Q(y)},Y=y=>{u(y)},r=()=>{u(null)},v=()=>{console.log("Round completed!")},C=(y,P,T)=>{g({id:y,currentName:P,positionName:T})},b=()=>{g(null)},E=(y,P)=>{Z.mutate({id:parseInt(y),data:{player_names:P}},{onSuccess:()=>{M(),g(null)}})},H=m.useCallback(async y=>{f(y),await U()},[U]),xe=D||[],oe=nt(k),ie=F==null?void 0:F.holes.find(y=>y.number===l),pe=()=>{V(!0)},ge=()=>{c!=null&&c.participants&&(c.participants.forEach(y=>{N.mutate(y.id)}),V(!1))},ye=((le=c==null?void 0:c.participants)==null?void 0:le.some(y=>y.is_locked))||!1;if(w)return e.jsx("div",{className:"p-4",children:"Loading competition..."});if(!i)return e.jsx("div",{className:"p-4",children:"Competition not found"});const be=()=>{switch(n){case"score":return!B||!F?e.jsx(Ct,{teeTimes:k||[],competitionId:a||""}):e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(wt,{teeTimeGroup:B,course:F,onScoreUpdate:q,onComplete:v,currentHole:l,onHoleChange:H,syncStatus:X,onPlayerNameClick:C,isReadyToFinalize:R,onFinalize:pe,isLocked:ye})})});case"leaderboard":return e.jsx(ct,{leaderboard:p,leaderboardLoading:j,onParticipantClick:Y,isRoundView:!0});case"teams":return e.jsx(lt,{teamResults:xe,leaderboardLoading:A,individualResults:p,isRoundView:!0});case"participants":return e.jsx(it,{teeTimes:k,teeTimesLoading:!1,competitionId:a||"",currentTeeTimeId:t,currentTeeTime:c,showCurrentGroup:!0,totalParticipants:oe});default:return null}};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(Xe,{title:i.name,seriesId:i.series_id,seriesName:i.series_name,children:e.jsx(rt,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:be()}),n==="score"&&ie&&e.jsx(ft,{currentHole:l,holePar:ie.par,onPrevious:()=>H(Math.max(1,l-1)),onNext:()=>H(Math.min(18,l+1)),canGoPrevious:l>1,canGoNext:l<18,className:"flex-shrink-0"}),e.jsx(mt,{activeTab:n,onTabChange:se,className:"flex-shrink-0"}),e.jsx(ht,{competition:i,courseName:h==null?void 0:h.name,totalParticipants:oe,variant:"footer"}),e.jsx(ot,{visible:d!==null,participant:ee,course:te,onClose:r}),e.jsx(xt,{isOpen:x!==null,onClose:b,onSave:E,participant:x}),e.jsx(he,{visible:O,teeTimeGroup:B||{id:"",players:[]},course:F||{id:"",name:"",holes:[]},currentHole:l,onClose:()=>V(!1),onContinueEntry:()=>V(!1),onLockRound:ge})]})}function Ct({teeTimes:a,competitionId:t}){const s=qe();return e.jsx("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-charcoal mb-4",children:"No Valid Tee Time"}),e.jsx("p",{className:"text-turf mb-6",children:"You don't have access to score entry for this competition. You can view the leaderboard or participant list instead."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s({to:`/player/competitions/${t}`}),className:"w-full bg-coral text-scorecard px-4 py-2 rounded-lg font-medium hover:bg-coral/90 transition-colors",children:"View Competition Details"}),a&&a.length>0&&e.jsxs("div",{className:"text-sm text-turf",children:[e.jsx("p",{className:"mb-2",children:"Available tee times:"}),e.jsxs("div",{className:"space-y-1",children:[a.slice(0,3).map(n=>e.jsxs("div",{className:"text-xs",children:[n.teetime," - ",n.participants.length," players"]},n.id)),a.length>3&&e.jsxs("div",{className:"text-xs",children:["... and ",a.length-3," more"]})]})]})]})]})})}export{kt as default};
