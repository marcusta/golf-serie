import{j as e,b as U,c as A,C as de,U as T,e as J,P as L,f as me,g as he,r as p,h as xe,i as ue,k as pe,l as fe,m as ge,n as je,o as ye,p as be,q as Ne,s as M,t as ve,v as we,w as _e,G as Ce,x as Se,y as Le,J as Ie}from"./index-f72iVvTN.js";import{C as Pe,a as ke,g as Te,d as Ee,c as Fe,P as $e,L as De,T as He,b as Ge,e as Oe}from"./TeamResultComponent-TQPPADbe.js";function Me({seriesId:t,seriesName:c}){return e.jsx(U,{to:"/player/series/$serieId",params:{serieId:t.toString()},className:"block border-l-4 border-turf pl-4 py-3 hover:bg-turf/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-turf"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-turf font-semibold uppercase",children:"Part of a Series"}),e.jsx("h4",{className:"font-semibold text-charcoal group-hover:text-fairway transition-colors",children:c})]})]}),e.jsx(de,{className:"h-5 w-5 text-turf/50 group-hover:text-fairway transition-colors"})]})})}function Ue(t,c){const f=c?t.find(l=>l.tee_time_id===c):void 0,N=c?t.filter(l=>l.tee_time_id!==c):t,a=[],o=[],h=[];for(const l of N)l.status==="on_course"?a.push(l):l.status==="finished"?h.push(l):o.push(l);return{myGroup:f,onCourse:a,registered:o,finished:h}}function Ae(t){if(t.members.length===0)return 0;const c=t.members.map(f=>f.holes_played||0);return Math.min(...c)}function Je(t){if(!t||t==="-")return;if(t==="E")return 0;const c=parseInt(t,10);return isNaN(c)?void 0:c}function We(t){switch(t){case"on_course":return"On Course";case"finished":return"Finished";default:return"Registered"}}function Be({groups:t,isLoading:c,myTeeTimeId:f,isOpenStart:N=!0}){if(c)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-coral border-t-transparent rounded-full"})});if(!t||t.length===0)return e.jsxs("div",{className:"text-center py-12 text-charcoal/70",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 text-charcoal/30"}),e.jsx("p",{className:"text-lg font-medium",children:"No players yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Players will appear here once they register"})]});const{myGroup:a,onCourse:o,registered:h,finished:l}=Ue(t,f),s=t.reduce((r,n)=>r+n.members.length,0),w=o.length+((a==null?void 0:a.status)==="on_course"?1:0),d=r=>{const n=r.current_score,y=Je(n),g=y!==void 0?Te(y):"text-charcoal";return e.jsxs("div",{className:"px-4 py-3 flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-fairway truncate",children:r.name}),e.jsxs("div",{className:"text-xs text-charcoal/50 mt-0.5",children:[r.category_name&&e.jsxs("span",{children:["(",r.category_name,") "]}),"HCP ",r.handicap!==void 0?r.handicap.toFixed(1):"-"]})]}),n&&n!=="-"&&e.jsx("div",{className:`text-sm font-semibold ml-3 ${g}`,children:n})]},r.player_id)},u=(r,n,y)=>e.jsxs("div",{className:`border-l-4 transition-colors ${y?"border-turf":"border-soft-grey hover:border-turf"}`,children:[e.jsxs("div",{className:"bg-rough/20 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-charcoal/50 font-primary",children:[r.members.length," player",r.members.length!==1?"s":""]}),n]}),e.jsx("div",{className:"divide-y divide-soft-grey/50",children:r.members.map(d)})]},r.tee_time_id),v=r=>{if(r.status==="on_course"){const n=Ae(r);if(n>0)return e.jsxs("span",{className:"text-xs text-charcoal/60 font-semibold font-primary",children:["Hole ",n]})}return r.status==="finished"?e.jsx("span",{className:"text-xs text-charcoal/60 font-medium font-primary",children:"Done"}):null};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-charcoal/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs("span",{children:[s," players"]})]}),w>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4 text-coral"}),e.jsxs("span",{children:[w," on course"]})]})]}),a&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-turf"}),"Your Group",e.jsx("span",{className:"text-xs text-coral font-semibold",children:We(a.status)})]}),e.jsx("div",{className:"space-y-3",children:u(a,v(a),!0)})]}),o.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-coral"}),"On Course",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",o.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:o.map(r=>u(r,v(r)))})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-charcoal/40"}),N?"Waiting to Start":"Not Started",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",h.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:h.map(r=>u(r))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-turf"}),"Finished",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",l.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:l.map(r=>u(r,v(r)))})]}),!a&&o.length===0&&h.length===0&&l.length===0&&e.jsx("div",{className:"text-center py-6 text-charcoal/50 text-sm font-primary",children:"No groups in this competition."})]})}function qe(){var H,G,O;const{competitionId:t}=me({strict:!1}),c=he({strict:!1}),f=c==null?void 0:c.fromTeeTime,N=()=>{const i=window.location.hash.replace("#","");return i==="leaderboard"?"leaderboard":i==="teamresult"?"teamresult":"startlist"},[a,o]=p.useState(N),[h,l]=p.useState(null),{data:s,isLoading:w}=xe(t?parseInt(t):0),{data:d}=ue((s==null?void 0:s.course_id)||0);pe((s==null?void 0:s.series_id)||0);const{data:u,isLoading:v,refetch:r}=fe(t?parseInt(t):0),{data:n,isLoading:y,refetch:g}=ge(t?parseInt(t):0),_=n==null?void 0:n.entries,W=n==null?void 0:n.scoringMode,b=n==null?void 0:n.tee,B=n==null?void 0:n.categoryTees,R=n==null?void 0:n.categories,{data:Y,isLoading:q,refetch:z}=je(t?parseInt(t):0),[K,E]=p.useState(!1),{data:I}=ye(),Q=s==null?void 0:s.tour_id,P=I==null?void 0:I.find(i=>i.tour_id===Q),F=(P==null?void 0:P.status)==="active",C=(s==null?void 0:s.tour_id)&&(s==null?void 0:s.start_mode)==="open",{data:m,refetch:$}=be(C?parseInt(t||"0"):0),V=!!(s!=null&&s.tour_id),{data:X,isLoading:Z}=Ne(V?parseInt(t||"0"):0),ee=(H=m==null?void 0:m.registration)==null?void 0:H.participant_id,{data:k}=M(ee||0),se=(((G=k==null?void 0:k.score)==null?void 0:G.filter(i=>i>0).length)??0)>=18,te=p.useCallback(()=>{if(!(s!=null&&s.open_start)||!(s!=null&&s.open_end))return!1;const i=new Date,x=new Date(s.open_start),S=new Date(s.open_end);return i>=x&&i<=S},[s==null?void 0:s.open_start,s==null?void 0:s.open_end]),{data:j}=M(h||0),D=i=>{l(i)},ae=()=>{l(null)},re=p.useCallback(()=>{window.history.back()},[]),ne=u&&u.length>0&&d?{id:d.id.toString(),name:d.name,holes:u[0].pars.map((i,x)=>({number:x+1,par:i}))}:null,ie=j?{id:j.id,team_name:j.team_name,position_name:j.position_name,player_names:j.player_names,score:j.score,tee_time_id:j.tee_time_id}:null,oe=(()=>{if(!h||!_||!(b!=null&&b.strokeIndex))return;const i=_.find(S=>S.participant.id===h);if(!i||i.courseHandicap===void 0)return;const x=Ee(i.courseHandicap,b.strokeIndex);return{strokeIndex:b.strokeIndex,handicapStrokesPerHole:x,courseHandicap:i.courseHandicap,handicapIndex:i.participant.handicap_index}})();if(p.useEffect(()=>{const i=()=>{const x=window.location.hash.replace("#","");x==="leaderboard"?o("leaderboard"):x==="teamresult"?o("teamresult"):x==="whosplaying"?o("whosplaying"):(s==null?void 0:s.start_mode)!=="open"?o("startlist"):o("leaderboard")};return window.addEventListener("hashchange",i),()=>window.removeEventListener("hashchange",i)},[s==null?void 0:s.start_mode]),p.useEffect(()=>{(s==null?void 0:s.start_mode)==="open"&&a==="startlist"&&o("leaderboard")},[s==null?void 0:s.start_mode,a]),p.useEffect(()=>{if(a==="leaderboard"||a==="teamresult"){const i=`lastFetch-${a}-${t}`,x=sessionStorage.getItem(i);(x?Date.now()-parseInt(x):1/0)>1e4&&(console.log(`Initial fetch for ${a} view...`),g(),a==="teamresult"&&r(),sessionStorage.setItem(i,Date.now().toString()))}},[a,t,g,r]),p.useEffect(()=>{if(!t||a!=="leaderboard"&&a!=="teamresult")return;const i=setInterval(()=>{console.log(`Periodic sync for ${a} view...`),g(),a==="teamresult"&&r()},3e4);return()=>clearInterval(i)},[a,t,g,r]),w)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Loading competition..."});if(!s)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Competition not found"});const ce=Fe(u),le=Y||[];return e.jsxs(ve,{title:s.name,subtitle:d==null?void 0:d.name,onBackClick:re,seriesId:s.series_id,seriesName:s.series_name,customActions:e.jsx("div",{className:"flex items-center gap-4",children:f&&e.jsxs(U,{to:`/player/competitions/${t}/tee-times/${f}`,className:"flex items-center gap-2 px-3 py-2 bg-coral text-scorecard rounded-xl hover:bg-[#E8890A] hover:-translate-y-0.5 transition-all duration-200 text-sm font-medium font-primary border border-coral",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to"}),e.jsx("span",{children:"Score"})]})}),children:[e.jsxs("div",{className:"flex-1 space-y-4 md:space-y-6 p-4 md:p-6",children:[e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-fairway font-display",children:s.name})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-6 text-xs md:text-sm text-charcoal/70 font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"truncate",children:(d==null?void 0:d.name)||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsxs("span",{children:[ce," participants"]})]})]}),(s==null?void 0:s.series_id)&&s.series_name&&e.jsx(Me,{seriesId:s.series_id,seriesName:s.series_name}),C&&te()&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-coral/10 border border-coral/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-coral/20 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-coral text-scorecard animate-pulse",children:"OPEN NOW"})}),e.jsxs("p",{className:"text-body-sm text-charcoal/70",children:["Open until"," ",new Date(s.open_end).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),F&&(m!=null&&m.registered)&&m.registration?e.jsx(Ce,{competitionId:parseInt(t||"0"),registration:m.registration,group:m.group,teeTimeId:m.registration.tee_time_id,participantId:m.registration.participant_id,onUpdate:()=>$(),hideActions:se}):F?e.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-turf hover:bg-fairway text-scorecard rounded-xl font-semibold text-lg transition-colors",children:[e.jsx(L,{className:"h-5 w-5"}),"Join This Round"]}):e.jsx("div",{className:"bg-rough/50 border border-soft-grey rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-body-md text-charcoal/70",children:"You must be enrolled in this tour to join rounds"})})]}),e.jsx("div",{className:"border-b border-soft-grey",children:e.jsxs("nav",{className:"flex space-x-4 md:space-x-8",children:[(s==null?void 0:s.start_mode)!=="open"&&e.jsxs("button",{onClick:()=>{o("startlist"),window.location.hash=""},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="startlist"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(J,{className:"h-3 w-3 md:h-4 md:w-4"}),"Start List"]}),e.jsxs("button",{onClick:()=>{o("leaderboard"),window.location.hash="leaderboard",console.log("Syncing data for leaderboard view..."),g()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                ${a==="leaderboard"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
              `,children:[e.jsx(A,{className:"h-3 w-3 md:h-4 md:w-4"}),"Leaderboard"]}),C&&e.jsxs("button",{onClick:()=>{o("whosplaying"),window.location.hash="whosplaying"},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="whosplaying"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(Se,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Who's Playing"}),e.jsx("span",{className:"sm:hidden",children:"Groups"})]}),!(s!=null&&s.tour_id)&&e.jsxs("button",{onClick:()=>{o("teamresult"),window.location.hash="teamresult",console.log("Syncing data for team results view..."),g(),z(),r()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="teamresult"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(Le,{className:"h-3 w-3 md:h-4 md:w-4"}),"Team Result"]})]})}),a==="startlist"&&e.jsx($e,{teeTimes:u,teeTimesLoading:v,competitionId:t,venueType:s==null?void 0:s.venue_type}),a==="leaderboard"&&e.jsx(De,{leaderboard:_,leaderboardLoading:y,onParticipantClick:D,isTourCompetition:!!(s!=null&&s.tour_id),scoringMode:W,teeInfo:b,categoryTees:B,categories:R}),a==="teamresult"&&e.jsx(He,{teamResults:le,leaderboardLoading:q,individualResults:_,onParticipantClick:D}),a==="whosplaying"&&e.jsx(Be,{groups:X,isLoading:Z,myTeeTimeId:(O=m==null?void 0:m.registration)==null?void 0:O.tee_time_id,isOpenStart:(s==null?void 0:s.start_mode)==="open"})]}),e.jsx(Ge,{visible:h!==null,participant:ie,course:ne,onClose:ae,isTourCompetition:!!(s!=null&&s.tour_id),netScoringData:oe}),C&&e.jsx(Ie,{isOpen:K,onClose:()=>E(!1),competitionId:parseInt(t||"0"),competitionName:(s==null?void 0:s.name)||"",courseName:d==null?void 0:d.name,openUntil:s==null?void 0:s.open_end,onSuccess:()=>$()})]})}export{qe as default};
