var je=Object.defineProperty;var ve=(a,t,s)=>t in a?je(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var de=(a,t,s)=>ve(a,typeof t!="symbol"?t+"":t,s);import{q as Se,j as e,s as C,a as we,p as Ce,U as me,t as he,C as Ie,m as Pe,n as Ee,r as m,R as ke,P as De,v as Ae,w as Le,x as Re,y as _e,X as ie,d as Fe,e as He,g as $e,h as Ve,i as Oe,z as Me,k as Ke,B as ze,D as Be,E as Te,F as Ge,G as fe,H as Ue,b as Ye,f as Je,I as We,J as Xe,l as qe}from"./index-D1igqBGW.js";import{P as Qe,S as Ze,f as et,g as tt,d as st,i as at,c as nt,H as rt,b as ot,a as it,T as lt,L as ct}from"./TeamResultComponent-DkKCdhiF.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ut=Se("pencil",dt);function mt({activeTab:a,onTabChange:t,className:s}){const n=[{id:"score",label:"Score Entry",shortLabel:"Score",icon:Qe,disabled:!1},{id:"leaderboard",label:"Leaderboard",shortLabel:"Leaderboard",icon:we,disabled:!1},{id:"teams",label:"Team Results",shortLabel:"Teams",icon:Ce,disabled:!1},{id:"participants",label:"Participants",shortLabel:"Start List",icon:me,disabled:!1}];return e.jsx("div",{className:C("bg-scorecard border-t-2 border-soft-grey shadow-[0_-2px_8px_rgba(27,67,50,0.08)]",s),children:e.jsx("div",{className:"grid grid-cols-4 max-w-lg mx-auto",children:n.map(o=>{const d=a===o.id,u=o.icon;return e.jsxs("button",{onClick:()=>!o.disabled&&t(o.id),disabled:o.disabled,className:C("flex flex-col items-center justify-center py-3 px-2 transition-all duration-200 touch-manipulation","min-h-[60px] md:min-h-[64px] font-['Inter']",d?"text-coral bg-gradient-to-b from-coral/10 to-coral/5 border-t-2 border-coral":"text-charcoal hover:text-turf hover:bg-rough/30",o.disabled&&"opacity-50 cursor-not-allowed"),children:[e.jsx(u,{className:C("mb-1 transition-all duration-200",d?"w-6 h-6":"w-5 h-5","md:w-6 md:h-6")}),e.jsxs("span",{className:C("text-xs font-medium transition-all duration-200","md:text-sm",d&&"font-semibold"),children:[e.jsx("span",{className:"sm:hidden",children:o.shortLabel}),e.jsx("span",{className:"hidden sm:inline",children:o.label})]})]},o.id)})})})}function ht({currentHole:a,holePar:t,holeHcp:s,onPrevious:n,onNext:o,canGoPrevious:d,canGoNext:u,className:x}){return e.jsx("div",{className:C("bg-coral text-charcoal px-4 py-2","shadow-lg border-t border-coral/20",x),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,disabled:!d,className:C("p-2 rounded-lg transition-all duration-200 touch-manipulation",d?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(he,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-8 text-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Par"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:t})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Holes"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:a})]}),s!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"HCP"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:s})]})]}),e.jsx("button",{onClick:o,disabled:!u,className:C("p-2 rounded-lg transition-all duration-200 touch-manipulation",u?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(Ie,{className:"w-6 h-6"})})]})})}function ft({competition:a,courseName:t,totalParticipants:s,variant:n="footer"}){const o=n==="header"?"bg-rough/30 rounded-xl p-4 border border-soft-grey":"bg-rough/30 border-t border-soft-grey px-4 py-2 flex-shrink-0";return e.jsx("div",{className:o,children:e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-8 text-label-sm text-charcoal font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(a.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(a.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ee,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"truncate",children:t||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{className:"h-4 w-4 text-turf"}),e.jsxs("span",{children:[s," participants"]})]})]})})}function xt({isOpen:a,onClose:t,onSave:s,participant:n}){const[o,d]=m.useState("");m.useEffect(()=>{n&&d(n.currentName||"")},[n]);const u=()=>{if(!n)return;const c=o.trim();c.length!==0&&s(n.id,c)},x=()=>{d((n==null?void 0:n.currentName)||""),t()},p=c=>{c.key==="Enter"?(c.preventDefault(),u()):c.key==="Escape"&&(c.preventDefault(),x())};return n?e.jsx(ke,{open:a,onOpenChange:t,children:e.jsxs(De,{children:[e.jsx(Ae,{className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsx(Le,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm shadow-xl border border-soft-grey max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Re,{className:"text-lg font-semibold text-fairway font-display",children:"Edit Player Name"}),e.jsx(_e,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors","aria-label":"Close",children:e.jsx(ie,{className:"h-4 w-4 text-flag"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-turf font-primary",children:["Editing position:"," ",e.jsx("span",{className:"font-medium",children:n.positionName})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"player-name",className:"block text-sm font-medium text-charcoal mb-2 font-primary",children:"Player Name"}),e.jsx("input",{id:"player-name",type:"text",value:o,onChange:c=>d(c.target.value),onKeyDown:p,className:"w-full p-3 border-2 border-soft-grey rounded-xl text-charcoal font-primary focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors outline-none",placeholder:"Enter player name",autoFocus:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:x,className:"flex-1 p-3 bg-rough bg-opacity-30 text-fairway rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:o.trim().length===0,className:C("flex-1 p-3 rounded-xl font-medium font-primary transition-colors",o.trim().length>0?"bg-turf text-scorecard hover:bg-fairway":"bg-soft-grey text-soft-grey cursor-not-allowed"),children:"Save"})]})]})})]})}):null}function pt({competitionId:a,teeTimeId:t,selectedParticipantId:s}){const{data:n,isLoading:o}=Fe(a?parseInt(a):0),{data:d}=He((n==null?void 0:n.course_id)||0),{data:u,refetch:x}=$e(a?parseInt(a):0),{data:p,isLoading:c,refetch:h}=Ve(a?parseInt(a):0),r=p,{data:f,isLoading:I,refetch:A}=Oe(a?parseInt(a):0),{data:L,refetch:l}=Me(t?parseInt(t):0),{data:N}=Ke(s||0),S=ze();return{competition:n,course:d,teeTimes:u,leaderboard:r,teamLeaderboard:f,teeTime:L,selectedParticipant:N,isLoading:o,leaderboardLoading:c,teamLeaderboardLoading:I,refetchTeeTime:l,refetchLeaderboard:h,refetchTeamLeaderboard:A,refetchTeeTimes:x,updateScoreMutation:S}}const re="golf-pending-scores",ue=3,V=class V{constructor(){}static getInstance(){return V.instance||(V.instance=new V),V.instance}addPendingScore(t,s,n){const o=this.getPendingScores(),d=`${t}-${s}`;o[d]={participantId:t,hole:s,shots:n,timestamp:Date.now(),attempts:0},this.savePendingScores(o)}removePendingScore(t,s){const n=this.getPendingScores(),o=`${t}-${s}`;delete n[o],this.savePendingScores(n)}getPendingScores(){try{const t=localStorage.getItem(re);return t?JSON.parse(t):{}}catch{return{}}}getPendingScoresArray(){const t=this.getPendingScores();return Object.values(t)}getPendingCount(){return this.getPendingScoresArray().length}markAttempted(t,s){const n=this.getPendingScores(),o=`${t}-${s}`;return n[o]?(n[o].attempts+=1,n[o].attempts>=ue&&delete n[o],this.savePendingScores(n),!!n[o]):!1}clearPendingScores(){localStorage.removeItem(re)}getRetryableScores(){return this.getPendingScoresArray().filter(t=>t.attempts<ue)}hasConnectivityIssues(){const t=this.getPendingScoresArray(),s=Math.min(...t.map(n=>n.timestamp));return t.length>0&&Date.now()-s>3e4}savePendingScores(t){try{localStorage.setItem(re,JSON.stringify(t))}catch(s){console.error("Failed to save pending scores to localStorage:",s)}}};de(V,"instance");let oe=V;const D={TAB_CHANGE:15e3,VISIBILITY_CHANGE:6e4,PERIODIC:3e4,HOLE_NAVIGATION:2e4,INITIAL_FETCH:1e4};class H{static shouldSync(t,s){return Date.now()-t>s}static getSessionKey(t,s){return`golf-sync-${t}-${s}`}static needsInitialSync(t){return!sessionStorage.getItem(t)}static markSyncCompleted(t){sessionStorage.setItem(t,Date.now().toString())}static async handleInitialSync(t){if(!t.teeTimeId||!t.hasData)return!1;const s=this.getSessionKey("initial",t.teeTimeId);return this.needsInitialSync(s)?(console.log("Initial sync for score entry session..."),await t.onSync(),this.markSyncCompleted(s),!0):!1}static async handleTabChangeSync(t){const{newTab:s,teeTimeId:n,lastSyncTime:o}=t;s==="score"&&n&&this.shouldSync(o,D.TAB_CHANGE)&&(console.log("Syncing on tab change to score entry..."),await t.onSync()),(s==="leaderboard"||s==="teams")&&(console.log(`Syncing data for ${s} view...`),t.onLeaderboardSync&&await t.onLeaderboardSync(),s==="teams"&&t.onTeamsSync&&await t.onTeamsSync())}static async handleVisibilityChangeSync(t){return document.hidden||!t.isScoreEntry||!t.teeTimeId?!1:this.shouldSync(t.lastSyncTime,D.VISIBILITY_CHANGE)?(console.log("Syncing after returning to tab..."),await t.onSync(),!0):!1}static shouldSyncOnHoleChange(t,s){return t%3===1&&this.shouldSync(s,D.HOLE_NAVIGATION)}static async handleHoleNavigationSync(t){return t.teeTimeId&&this.shouldSyncOnHoleChange(t.currentHole,t.lastSyncTime)?(console.log(`Syncing on hole navigation to hole ${t.currentHole}...`),await t.onSync(),!0):!1}static needsInitialFetch(t,s){const n=`lastFetch-${t}-${s}`,o=sessionStorage.getItem(n);return(o?Date.now()-parseInt(o):1/0)>D.INITIAL_FETCH}static markInitialFetchCompleted(t,s){const n=`lastFetch-${t}-${s}`;sessionStorage.setItem(n,Date.now().toString())}static async handleInitialViewFetch(t,s,n,o){return this.needsInitialFetch(t,s)?(console.log(`Initial fetch for ${t} view...`),await n(),t==="teams"&&o&&await o(),this.markInitialFetchCompleted(t,s),!0):!1}static createSyncStatus(t,s){const n=t.getPendingCount();return{pendingCount:n,lastSyncTime:s,isOnline:navigator.onLine,hasConnectivityIssues:n>0&&Date.now()-s>D.PERIODIC}}static shouldRunPeriodicSync(t){return t==="leaderboard"||t==="teams"}static async handlePeriodicViewSync(t,s,n){this.shouldRunPeriodicSync(t)&&(console.log(`Periodic sync for ${t} view...`),await s(),t==="teams"&&n&&await n())}static shouldRetryPendingScores(t,s){return t.length>0||this.shouldSync(s,D.PERIODIC)}}function gt({competitionId:a,teeTimeId:t,activeTab:s,refetchTeeTime:n,refetchLeaderboard:o,refetchTeamLeaderboard:d,refetchTeeTimes:u,updateScoreMutation:x,teeTime:p}){const c=oe.getInstance(),[h,r]=m.useState(Date.now());m.useEffect(()=>{s==="score"&&t&&p&&H.handleInitialSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:h,hasData:!!p,onSync:async()=>{await n(),r(Date.now())}})},[s,t,p,n,a,h]),m.useEffect(()=>{const l=async()=>{await H.handleVisibilityChangeSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:h,isScoreEntry:s==="score",onSync:async()=>{await n(),r(Date.now())}})&&r(Date.now())};return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[s,t,h,n,a]),m.useEffect(()=>{if(!t)return;const l=setInterval(async()=>{try{let N=!1;const S=c.getRetryableScores();if(S.length>0){console.log(`Retrying ${S.length} pending scores...`),N=!0;for(const j of S)try{await x.mutateAsync({participantId:j.participantId,hole:j.hole,shots:j.shots}),c.removePendingScore(j.participantId,j.hole)}catch(E){c.markAttempted(j.participantId,j.hole),console.error(`Retry failed for score ${j.participantId}-${j.hole}:`,E)}}H.shouldRetryPendingScores(S,h)&&(N||H.shouldSync(h,D.PERIODIC))&&(console.log("Syncing with server for latest scores..."),await n(),r(Date.now()))}catch(N){console.error("Sync validation failed:",N)}},D.PERIODIC);return()=>clearInterval(l)},[t,x,n,c,h]),m.useEffect(()=>{if(!a||!H.shouldRunPeriodicSync(s))return;const l=setInterval(async()=>{await H.handlePeriodicViewSync(s,async()=>{await o(),d&&await d()},async()=>{await u()}),r(Date.now())},D.PERIODIC);return()=>clearInterval(l)},[s,a,o,d,u]),m.useEffect(()=>{(s==="leaderboard"||s==="teams")&&a&&H.handleInitialViewFetch(s,a,async()=>{await o(),d&&await d()},async()=>{await u()})},[s,a,o,d,u]);const f=H.createSyncStatus(c,h),I=m.useCallback((l,N,S)=>{const j=parseInt(l);c.addPendingScore(j,N,S),x.mutate({participantId:j,hole:N,shots:S},{onSuccess:()=>{c.removePendingScore(j,N),r(Date.now())},onError:E=>{console.error("Score update failed:",E),c.markAttempted(j,N)}})},[x,c]),A=m.useCallback(async l=>{(l==="leaderboard"||l==="teams")&&(await o(),d&&await d()),(l==="teams"||l==="participants")&&await u(),r(Date.now())},[o,d,u]),L=m.useCallback(async()=>{t&&(await n(),r(Date.now()))},[n,t]);return{syncStatus:f,handleScoreUpdate:I,handleTabChangeSync:A,handleHoleNavigationSync:L}}function yt(a){return a?{id:a.id.toString(),players:a.participants.map(t=>({participantId:t.id.toString(),participantName:t.team_name,participantType:Te(t.position_name),isMultiPlayer:Be(t.position_name),scores:t.score,playerNames:t.player_names}))}:null}function bt(a){return a?{id:a.id,team_name:a.team_name,position_name:a.position_name,player_names:a.player_names,score:a.score,tee_time_id:a.tee_time_id}:null}const xe=a=>`golf-current-hole-${a}`,Nt=(a,t)=>{a&&t&&sessionStorage.setItem(xe(a),t.toString())};function jt({onNumberPress:a,onSpecialPress:t,onDismiss:s,visible:n,holePar:o,currentHole:d,playerName:u}){const x=r=>{a(r)},p=r=>{t(r)},c=()=>{s&&s()},h=r=>{if(r===1)return"HIO";const f=r-o;return f<=-4?"OTHER":f===-3?"ALBA":f===-2?"EAGLE":f===-1?"BIRDIE":f===0?"PAR":f===1?"BOGEY":f===2?"DOUBLE":f===3?"TRIPLE":f===4?"QUAD":f>=5?"OTHER":""};return n?e.jsxs("div",{className:C("fixed bottom-0 left-0 right-0 bg-scorecard border-t border-soft-grey transition-transform duration-300 ease-in-out z-50",n?"translate-y-0":"translate-y-full","shadow-lg rounded-t-xl"),children:[e.jsx("div",{className:"bg-turf text-scorecard px-4 py-2 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-lg font-bold font-display",children:["Hole ",d," | Par ",o]})})}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-soft-grey bg-rough bg-opacity-20",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm font-medium text-fairway font-primary",children:u||"Enter Score"})}),s&&e.jsx("button",{onMouseDown:r=>{r.preventDefault(),c()},className:"p-2 rounded-xl bg-rough bg-opacity-30 hover:bg-rough hover:bg-opacity-50 transition-colors touch-manipulation focus:outline-none","aria-label":"Close keyboard",children:e.jsx(ie,{className:"w-5 h-5 text-fairway"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[1,2,3].map(r=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),x(r)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:r}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:h(r)})]},r))}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[4,5,6].map(r=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),x(r)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:r}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:h(r)})]},r))}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[[7,8].map(r=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),x(r)},className:"h-14 bg-rough bg-opacity-40 hover:bg-rough hover:bg-opacity-60 active:bg-rough active:bg-opacity-80 rounded-xl text-xl font-bold text-fairway transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:r}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:h(r)})]},r)),e.jsxs("button",{onMouseDown:r=>{r.preventDefault(),p("more")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"9+"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:h(9)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onMouseDown:r=>{r.preventDefault(),p("clear")},className:"h-14 bg-transparent border-2 border-flag text-flag hover:bg-flag/10 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"âˆ’"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"GAVE UP"})]}),e.jsxs("button",{onMouseDown:r=>{r.preventDefault(),p("unreported")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"0"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"CLEAR"})]})]})]})]}):null}function pe({visible:a,teeTimeGroup:t,course:s,currentHole:n,onClose:o,onContinueEntry:d,onLockRound:u}){const[x,p]=m.useState(!1);return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:[e.jsxs("div",{className:C("bg-scorecard w-full max-h-[90vh] rounded-t-2xl transition-transform duration-300 ease-in-out border-t border-soft-grey","transform translate-y-0"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-soft-grey",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-rough hover:bg-opacity-30 rounded-xl transition-colors",children:e.jsx(he,{className:"h-5 w-5 text-fairway"})}),e.jsx("h2",{className:"text-lg font-semibold font-display text-fairway",children:"Full Scorecard"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors",children:e.jsx(ie,{className:"h-5 w-5 text-flag"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsx("div",{className:"px-2 py-4 space-y-6",children:t.players.map(c=>e.jsx(Ze,{participant:{id:c.participantId,name:c.participantName,type:c.participantType,isMultiPlayer:c.isMultiPlayer,scores:c.scores},course:s,currentHole:n},c.participantId))})}),e.jsxs("div",{className:"p-4 border-t border-soft-grey space-y-3",children:[e.jsxs("button",{onClick:()=>d(n),className:"w-full bg-turf text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-fairway transition-colors font-primary",children:["Continue Entry on Hole ",n]}),u&&e.jsx("button",{onClick:()=>p(!0),className:"w-full bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize and Lock Round"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-coral bg-opacity-20 rounded-full",children:e.jsx(Ge,{className:"w-6 h-6 text-coral"})}),e.jsx("h2",{className:"text-xl font-bold text-center font-display text-fairway mb-2",children:"Finalize Round"}),e.jsx("p",{className:"text-center text-charcoal mb-6 font-primary",children:"Are you sure you want to finalize and lock this round? This action cannot be undone and will prevent any further score changes."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 bg-soft-grey bg-opacity-30 text-charcoal py-3 px-4 rounded-xl font-medium hover:bg-soft-grey hover:bg-opacity-50 transition-colors font-primary",children:"Cancel"}),e.jsx("button",{onClick:()=>{p(!1),u==null||u()},className:"flex-1 bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize & Lock"})]})]})})})]}):null}function vt({onScoreSubmit:a,onCancel:t}){const[s,n]=m.useState(!1),[o,d]=m.useState(""),u=m.useCallback(()=>{n(!0),d("")},[]),x=m.useCallback(()=>{n(!1),d(""),t()},[t]),p=m.useCallback(()=>{const h=parseInt(o,10);!isNaN(h)&&h>=9&&(a(h),x())},[o,a,x]),c=m.useCallback(h=>{const r=h.target.value;/^\d*$/.test(r)&&d(r)},[]);return{isVisible:s,inputValue:o,show:u,hide:x,handleSubmit:p,handleInputChange:c}}function St({teeTimeGroup:a,course:t,onScoreUpdate:s,onComplete:n,currentHole:o,onHoleChange:d,syncStatus:u,onPlayerNameClick:x,isReadyToFinalize:p=!1,onFinalize:c,isLocked:h=!1,competition:r}){var J;const f=()=>{for(let i=17;i>=0;i--)if(a.players.some(w=>{const y=w.scores[i];return y&&y>0}))if(a.players.every(y=>{const k=y.scores[i];return k&&k!==0})){if(i<17)return i+2}else return i+1;return 1},I=fe(),[A,L]=m.useState(()=>f()),l=o!==void 0?o:A,[N,S]=m.useState(0),[j,E]=m.useState(!1),[B,O]=m.useState(!1),[T,K]=m.useState(!1),[W,G]=m.useState(!1),{isVisible:X,inputValue:q,show:U,hide:Q,handleSubmit:Z,handleInputChange:ee}=vt({onScoreSubmit:i=>{b&&(s(b.participantId,l,i),_())},onCancel:()=>{E(!0)}}),b=a.players[N],R=t.holes.find(i=>i.number===l),M=i=>{let v=0,w=0;for(let y=0;y<t.holes.length;y++){const k=i.scores[y];if(k===-1)return null;k&&k>0&&(v+=k,w+=t.holes[y].par)}return w===0?null:v-w},_=()=>{N<a.players.length-1?S(N+1):(G(!0),setTimeout(()=>{if(G(!1),l<18){const i=l+1;d?d(i):L(i),S(0)}else n()},800))},F=i=>{h||(S(i),E(!0),K(!0))},te=i=>{h||b&&(s(b.participantId,l,i),_())},se=i=>{if(!h){if(i==="more")E(!1),U();else if(i==="clear"){if(!b)return;s(b.participantId,l,-1),_()}else if(i==="unreported"){if(!b)return;s(b.participantId,l,0),_()}}},ae=()=>{E(!1),K(!1)},Y=i=>{x&&x(i.participantId,i.playerNames||null,i.participantType||"")},ne=i=>{const v=i.split(" ");if(v.length>=2){const w=v[0],y=v[1];return i.length<=14?i:w.length<=8?`${w} ${y.charAt(0)}.`:y.length<=8?`${w.charAt(0)}. ${y}`:`${w.charAt(0)}. ${y.charAt(0)}.`}return i.length>12?`${i.substring(0,11)}...`:i};return m.useEffect(()=>{const i=v=>{T&&!v.target.closest(".score-entry")&&(E(!1),K(!1))};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[T]),e.jsxs("div",{className:"score-entry flex flex-col h-screen-mobile bg-scorecard relative",children:[u&&(u.pendingCount>0||u.hasConnectivityIssues)&&e.jsx("div",{className:C("px-3 py-2 text-center text-xs font-medium",u.hasConnectivityIssues?"bg-flag text-scorecard border-b border-flag":"bg-coral text-scorecard border-b border-coral"),children:u.hasConnectivityIssues?e.jsxs("span",{children:["âš ï¸ Connection issues - ",u.pendingCount," score(s) pending"]}):e.jsxs("span",{children:["ðŸ“¡ Saving ",u.pendingCount," score(s)..."]})}),W&&e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-turf text-scorecard px-6 py-4 rounded-xl shadow-lg z-30 animate-pulse",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold font-display",children:["âœ“ Hole ",l," Complete!"]}),e.jsxs("div",{className:"text-sm opacity-90 font-primary",children:["Moving to hole ",l+1,"..."]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{minHeight:"60%"},children:[e.jsx("div",{className:"bg-rough bg-opacity-30 px-4 py-2 border-b border-soft-grey",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center space-x-4 relative left-[50px]",children:[l>1&&e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:l-1}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par"," ",((J=t.holes.find(i=>i.number===l-1))==null?void 0:J.par)||4]})]}),e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:l}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par ",(R==null?void 0:R.par)||4]})]}),e.jsx("div",{className:"w-12 h-6 opacity-0"})]})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[a.players.map((i,v)=>{const w=v===N,y=i.scores[l-1]??0,k=l>1?i.scores[l-2]??0:null,$=M(i);return e.jsx("div",{className:C("bg-scorecard rounded-lg p-4 shadow-sm border transition-all duration-200",w?"border-coral/20 shadow-md ring-2 ring-coral/10":"border-soft-grey"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>Y(i),className:"text-left w-full hover:bg-rough/10 rounded-md p-1 -m-1 transition-colors",children:i.playerNames?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:ne(i.playerNames)}),e.jsxs("p",{className:"text-label-sm text-turf font-primary",children:[i.participantName," ",i.participantType]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:[i.participantName," ",i.participantType]}),e.jsxs("div",{className:"flex items-center gap-1 text-label-sm text-soft-grey font-primary",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsx("span",{children:"+ Add player name"})]})]})}),e.jsx("span",{className:C("text-label-sm font-medium font-primary",$!==null?tt($):"text-soft-grey"),children:$!==null?et($):"-"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[l>1&&e.jsx("div",{className:"text-center w-12",children:e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:st(k||0)})}),e.jsx("button",{onClick:()=>F(v),disabled:h,className:C("w-12 h-12 rounded-full border-2 flex items-center justify-center text-label-sm font-medium touch-manipulation transition-colors",h?"border-soft-grey bg-soft-grey/20 cursor-not-allowed":"border-soft-grey bg-rough/10 text-turf hover:bg-rough/20"),children:e.jsx("span",{className:"text-lg font-bold text-fairway font-display",children:y>0?y:y===-1?"âˆ’":"0"})})]})]})},i.participantId)}),!p&&e.jsxs("button",{onClick:()=>O(!0),className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-lg transition-colors mt-6 flex items-center justify-center space-x-2 font-primary",children:[e.jsx(Ue,{size:20}),e.jsx("span",{children:"View Full Scorecard"})]}),p&&!h&&e.jsx("div",{className:"bg-scorecard border-t border-soft-grey p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>O(!0),className:"flex-1 bg-turf hover:bg-fairway text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Review Scorecard"})}),e.jsx("button",{onClick:c,className:"flex-1 bg-coral hover:bg-orange-600 text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Complete Round"})})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-turf bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-turf text-3xl",children:"âœ“"})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 font-display text-fairway",children:"Round Complete!"}),e.jsx("p",{className:"text-charcoal font-primary mb-8 leading-relaxed",children:"Your round has been successfully finalized and locked. All scores have been submitted and the results are now official."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{const i=window.location.pathname.split("/"),v=i[i.indexOf("competitions")+1];r!=null&&r.series_id?I({to:`/player/competitions/${v}`,hash:"teamresult"}):I({to:`/player/competitions/${v}`,hash:"leaderboard"})},className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"View Leaderboard"}),e.jsx("button",{onClick:()=>{r!=null&&r.series_id?I({to:`/player/series/${r.series_id}`}):I({to:"/player"})},className:"w-full bg-soft-grey bg-opacity-30 hover:bg-soft-grey hover:bg-opacity-50 text-charcoal font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:r!=null&&r.series_id?`Back to ${r.series_name}`:"Back to Home"})]})]})})})]})]}),!h&&e.jsx(jt,{visible:j,onNumberPress:te,onSpecialPress:se,holePar:(R==null?void 0:R.par)||4,currentHole:l,onDismiss:ae,teeTimeGroup:a,course:t,playerName:(b==null?void 0:b.playerNames)||`${b==null?void 0:b.participantName} ${b==null?void 0:b.participantType}`}),e.jsx(pe,{visible:B,teeTimeGroup:a,course:t,currentHole:l,onClose:()=>O(!1),onContinueEntry:i=>{L(i||l),S(0),O(!1)}}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm border border-soft-grey",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 font-display text-fairway",children:"Enter Score (9 or higher)"}),e.jsx("input",{type:"number",value:q,onChange:ee,className:"w-full p-3 border-2 border-soft-grey rounded-xl mb-4 text-2xl text-center font-display text-charcoal focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors",placeholder:"Enter score",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Q,className:"flex-1 p-3 bg-rough bg-opacity-30 rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary text-fairway transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Z,className:"flex-1 p-3 bg-turf text-scorecard rounded-xl hover:bg-fairway font-medium font-primary transition-colors",children:"Submit"})]})]})})]})}Array.from({length:18},(a,t)=>({number:t+1,par:Math.floor(Math.random()*2)+3}));Array(18).fill(null),Array(18).fill(null),Array(18).fill(null),Array(18).fill(null);function wt(a,t){return a?{id:a.id.toString(),name:t?t.name:`${a.course_name} ${a.teetime}`,holes:a.pars.map((s,n)=>({number:n+1,par:s}))}:null}function kt(){var ce;const{competitionId:a,teeTimeId:t}=Ye({strict:!1}),s=()=>{if(t)return"score";const g=window.location.hash.replace("#","");return g==="teams"?"teams":g==="participants"?"participants":"leaderboard"},[n,o]=m.useState(s),[d,u]=m.useState(null),[x,p]=m.useState(null),[c,h]=m.useState(()=>{if(t){const g=xe(t),P=sessionStorage.getItem(g);if(P){const z=parseInt(P,10);if(z>=1&&z<=18)return z}}return 1}),{competition:r,course:f,teeTimes:I,leaderboard:A,teamLeaderboard:L,teeTime:l,selectedParticipant:N,isLoading:S,leaderboardLoading:j,teamLeaderboardLoading:E,refetchTeeTime:B,refetchLeaderboard:O,refetchTeamLeaderboard:T,refetchTeeTimes:K,updateScoreMutation:W}=pt({competitionId:a,teeTimeId:t,selectedParticipantId:d}),{syncStatus:G,handleScoreUpdate:X,handleTabChangeSync:q,handleHoleNavigationSync:U}=gt({competitionId:a,teeTimeId:t,activeTab:n,refetchTeeTime:B,refetchLeaderboard:O,refetchTeamLeaderboard:T,refetchTeeTimes:K,updateScoreMutation:W,teeTime:l});Je((r==null?void 0:r.series_id)||0);const Q=We(),Z=Xe(),[ee,b]=m.useState(!1),[R,M]=m.useState(!1);m.useEffect(()=>{t&&c&&Nt(t,c)},[t,c]),m.useEffect(()=>{if(l!=null&&l.participants&&l.participants.length>0)if(l.participants.filter(P=>Array.isArray(P.score)).length===l.participants.length){const P=at(l.participants);b(P)}else b(!1);else b(!1)},[l]);const _=yt(l),F=wt(l,f),te=bt(N||null),se=l&&f?{id:f.id.toString(),name:f.name,holes:l.pars.map((g,P)=>({number:P+1,par:g}))}:null,ae=async g=>{o(g),await q(g)},Y=g=>{u(g)},ne=()=>{u(null)},J=()=>{console.log("Round completed!")},i=(g,P,z)=>{p({id:g,currentName:P,positionName:z})},v=()=>{p(null)},w=(g,P)=>{Q.mutate({id:parseInt(g),data:{player_names:P}},{onSuccess:()=>{B(),p(null)}})},y=m.useCallback(async g=>{h(g),await U()},[U]),k=L||[],$=nt(I),le=F==null?void 0:F.holes.find(g=>g.number===c),ge=()=>{M(!0)},ye=()=>{l!=null&&l.participants&&(l.participants.forEach(g=>{Z.mutate(g.id)}),M(!1))},be=((ce=l==null?void 0:l.participants)==null?void 0:ce.some(g=>g.is_locked))||!1;if(S)return e.jsx("div",{className:"p-4",children:"Loading competition..."});if(!r)return e.jsx("div",{className:"p-4",children:"Competition not found"});const Ne=()=>{switch(n){case"score":return!_||!F?e.jsx(Ct,{teeTimes:I||[],competitionId:a||""}):e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(St,{teeTimeGroup:_,course:F,onScoreUpdate:X,onComplete:J,currentHole:c,onHoleChange:y,syncStatus:G,onPlayerNameClick:i,isReadyToFinalize:ee,onFinalize:ge,isLocked:be,competition:{id:r.id,series_id:r.series_id,series_name:r.series_name}})})});case"leaderboard":return e.jsx(ct,{leaderboard:A,leaderboardLoading:j,onParticipantClick:Y,isRoundView:!0});case"teams":return e.jsx(lt,{teamResults:k,leaderboardLoading:E,individualResults:A,isRoundView:!0,onParticipantClick:Y});case"participants":return e.jsx(it,{teeTimes:I,teeTimesLoading:!1,competitionId:a||"",currentTeeTimeId:t,currentTeeTime:l,showCurrentGroup:!0,totalParticipants:$});default:return null}};return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(qe,{title:r.name,seriesId:r.series_id,seriesName:r.series_name,children:e.jsx(rt,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:Ne()}),n==="score"&&le&&e.jsx(ht,{currentHole:c,holePar:le.par,onPrevious:()=>y(Math.max(1,c-1)),onNext:()=>y(Math.min(18,c+1)),canGoPrevious:c>1,canGoNext:c<18,className:"flex-shrink-0"}),e.jsx(mt,{activeTab:n,onTabChange:ae,className:"flex-shrink-0"}),e.jsx(ft,{competition:r,courseName:f==null?void 0:f.name,totalParticipants:$,variant:"footer"}),e.jsx(ot,{visible:d!==null,participant:te,course:se,onClose:ne}),e.jsx(xt,{isOpen:x!==null,onClose:v,onSave:w,participant:x}),e.jsx(pe,{visible:R,teeTimeGroup:_||{id:"",players:[]},course:F||{id:"",name:"",holes:[]},currentHole:c,onClose:()=>M(!1),onContinueEntry:()=>M(!1),onLockRound:ye})]})}function Ct({teeTimes:a,competitionId:t}){const s=fe();return e.jsx("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-charcoal mb-4",children:"No Valid Tee Time"}),e.jsx("p",{className:"text-turf mb-6",children:"You don't have access to score entry for this competition. You can view the leaderboard or participant list instead."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s({to:`/player/competitions/${t}`}),className:"w-full bg-coral text-scorecard px-4 py-2 rounded-lg font-medium hover:bg-coral/90 transition-colors",children:"View Competition Details"}),a&&a.length>0&&e.jsxs("div",{className:"text-sm text-turf",children:[e.jsx("p",{className:"mb-2",children:"Available tee times:"}),e.jsxs("div",{className:"space-y-1",children:[a.slice(0,3).map(n=>e.jsxs("div",{className:"text-xs",children:[n.teetime," - ",n.participants.length," players"]},n.id)),a.length>3&&e.jsxs("div",{className:"text-xs",children:["... and ",a.length-3," more"]})]})]})]})]})})}export{kt as default};
