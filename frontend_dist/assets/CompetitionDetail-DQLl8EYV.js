import{j as e,b as F,c as B,C as Q,F as ue,U as D,e as A,P as I,f as pe,g as fe,h as ge,i as je,r as p,k as ye,l as Ne,m as be,n as we,o as ve,p as _e,q as Ce,s as Se,t as Ie,v as R,w as Le,x as ke,y as Pe,z as Te,B as De,D as Fe,G as Ee,E as $e,H as He,I as Oe,J as Ge,Q as Ue,K as Me,R as Re}from"./index-BzzepWmo.js";import{C as Be,P as Qe,L as Ae,T as Je}from"./TeamResultComponent-B8ymf21P.js";function We({seriesId:t,seriesName:i}){return e.jsx(F,{to:"/player/series/$serieId",params:{serieId:t.toString()},className:"block border-l-4 border-turf pl-4 py-3 hover:bg-turf/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-turf"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-turf font-semibold uppercase",children:"Part of a Series"}),e.jsx("h4",{className:"font-semibold text-charcoal group-hover:text-fairway transition-colors",children:i})]})]}),e.jsx(Q,{className:"h-5 w-5 text-turf/50 group-hover:text-fairway transition-colors"})]})})}function ze({tourId:t,tourName:i}){return e.jsx(F,{to:"/player/tours/$tourId",params:{tourId:t.toString()},className:"block border-l-4 border-turf pl-4 py-3 hover:bg-turf/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"h-5 w-5 text-turf"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-turf font-semibold uppercase",children:"Part of a Tour"}),e.jsx("h4",{className:"font-semibold text-charcoal group-hover:text-fairway transition-colors",children:i})]})]}),e.jsx(Q,{className:"h-5 w-5 text-turf/50 group-hover:text-fairway transition-colors"})]})})}function Ke(t,i){const g=i?t.find(l=>l.tee_time_id===i):void 0,w=i?t.filter(l=>l.tee_time_id!==i):t,a=[],o=[],x=[];for(const l of w)l.status==="on_course"?a.push(l):l.status==="finished"?x.push(l):o.push(l);return{myGroup:g,onCourse:a,registered:o,finished:x}}function Ye(t){if(t.members.length===0)return 0;const i=t.members.map(g=>g.holes_played||0);return Math.min(...i)}function qe(t){if(!t||t==="-")return;if(t==="E")return 0;const i=parseInt(t,10);return isNaN(i)?void 0:i}function Ve(t){switch(t){case"on_course":return"On Course";case"finished":return"Finished";default:return"Registered"}}function Xe({groups:t,isLoading:i,myTeeTimeId:g,isOpenStart:w=!0}){if(i)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-coral border-t-transparent rounded-full"})});if(!t||t.length===0)return e.jsxs("div",{className:"text-center py-12 text-charcoal/70",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-charcoal/30"}),e.jsx("p",{className:"text-lg font-medium",children:"No players yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Players will appear here once they register"})]});const{myGroup:a,onCourse:o,registered:x,finished:l}=Ke(t,g),L=t.reduce((r,h)=>r+h.members.length,0),v=o.length+((a==null?void 0:a.status)==="on_course"?1:0),s=r=>{const h=r.current_score,f=qe(h),c=f!==void 0?fe(f):"text-charcoal";return e.jsxs("div",{className:"px-4 py-3 flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-fairway truncate",children:r.name}),e.jsxs("div",{className:"text-xs text-charcoal/50 mt-0.5",children:[r.category_name&&e.jsxs("span",{children:["(",r.category_name,") "]}),"HCP ",r.handicap!==void 0?r.handicap.toFixed(1):"-"]})]}),h&&h!=="-"&&e.jsx("div",{className:`text-sm font-semibold ml-3 ${c}`,children:h})]},r.player_id)},y=(r,h,f)=>e.jsxs("div",{className:`border-l-4 transition-colors ${f?"border-turf":"border-soft-grey hover:border-turf"}`,children:[e.jsxs("div",{className:"bg-rough/20 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-charcoal/50 font-primary",children:[r.members.length," player",r.members.length!==1?"s":""]}),h]}),e.jsx("div",{className:"divide-y divide-soft-grey/50",children:r.members.map(s)})]},r.tee_time_id),d=r=>{if(r.status==="on_course"){const h=Ye(r);if(h>0)return e.jsxs("span",{className:"text-xs text-charcoal/60 font-semibold font-primary",children:["Hole ",h]})}return r.status==="finished"?e.jsx("span",{className:"text-xs text-charcoal/60 font-medium font-primary",children:"Done"}):null};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-charcoal/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs("span",{children:[L," players"]})]}),v>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4 text-coral"}),e.jsxs("span",{children:[v," on course"]})]})]}),a&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-turf"}),"Your Group",e.jsx("span",{className:"text-xs text-coral font-semibold",children:Ve(a.status)})]}),e.jsx("div",{className:"space-y-3",children:y(a,d(a),!0)})]}),o.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-coral"}),"On Course",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",o.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:o.map(r=>y(r,d(r)))})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-charcoal/40"}),w?"Waiting to Start":"Not Started",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",x.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:x.map(r=>y(r))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-turf"}),"Finished",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",l.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:l.map(r=>y(r,d(r)))})]}),!a&&o.length===0&&x.length===0&&l.length===0&&e.jsx("div",{className:"text-center py-6 text-charcoal/50 text-sm font-primary",children:"No groups in this competition."})]})}function ss(){var G,U,M;const{competitionId:t}=ge({strict:!1}),i=je({strict:!1}),g=i==null?void 0:i.fromTeeTime,w=()=>{const n=window.location.hash.replace("#","");return n==="leaderboard"?"leaderboard":n==="teamresult"?"teamresult":"startlist"},[a,o]=p.useState(w),[x,l]=p.useState(null),[L,v]=p.useState(!1),{data:s,isLoading:y}=ye(t?parseInt(t):0),{data:d}=Ne((s==null?void 0:s.course_id)||0);be((s==null?void 0:s.series_id)||0);const{data:r,isLoading:h,refetch:f}=we(t?parseInt(t):0),{data:c,isLoading:J,refetch:N}=ve(t?parseInt(t):0),_=c==null?void 0:c.entries,W=c==null?void 0:c.scoringMode,b=c==null?void 0:c.tee,z=c==null?void 0:c.categoryTees,K=c==null?void 0:c.categories,{data:Y,isLoading:q,refetch:V}=_e(t?parseInt(t):0),[X,E]=p.useState(!1),{data:k}=Ce(),Z=s==null?void 0:s.tour_id,P=k==null?void 0:k.find(n=>n.tour_id===Z),$=(P==null?void 0:P.status)==="active",C=(s==null?void 0:s.tour_id)&&(s==null?void 0:s.start_mode)==="open",{data:m,refetch:H}=Se(C?parseInt(t||"0"):0),ee=!!(s!=null&&s.tour_id),{data:se,isLoading:te}=Ie(ee?parseInt(t||"0"):0),ae=(G=m==null?void 0:m.registration)==null?void 0:G.participant_id,{data:T}=R(ae||0),re=(((U=T==null?void 0:T.score)==null?void 0:U.filter(n=>n>0).length)??0)>=18,ne=p.useCallback(()=>{if(!(s!=null&&s.open_start)||!(s!=null&&s.open_end))return!1;const n=new Date,u=new Date(s.open_start),S=new Date(s.open_end);return n>=u&&n<=S},[s==null?void 0:s.open_start,s==null?void 0:s.open_end]),{data:j}=R(x||0),O=n=>{l(n)},ie=()=>{l(null)},oe=p.useCallback(()=>{window.history.back()},[]),le=r&&r.length>0&&d?{id:d.id.toString(),name:d.name,holes:r[0].pars.map((n,u)=>({number:u+1,par:n}))}:null,ce=j?{id:j.id,team_name:j.team_name,position_name:j.position_name,player_name:j.player_name,score:j.score,tee_time_id:j.tee_time_id}:null,de=(()=>{if(!x||!_||!(b!=null&&b.strokeIndex))return;const n=_.find(S=>S.participant.id===x);if(!n||n.courseHandicap===void 0)return;const u=Le(n.courseHandicap,b.strokeIndex);return{strokeIndex:b.strokeIndex,handicapStrokesPerHole:u,courseHandicap:n.courseHandicap,handicapIndex:n.participant.handicap_index}})(),me=p.useMemo(()=>ke(parseInt(t||"0")),[t]);if(p.useEffect(()=>{const n=()=>{const u=window.location.hash.replace("#","");u==="leaderboard"?o("leaderboard"):u==="teamresult"?o("teamresult"):u==="whosplaying"?o("whosplaying"):(s==null?void 0:s.start_mode)!=="open"?o("startlist"):o("leaderboard")};return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[s==null?void 0:s.start_mode]),p.useEffect(()=>{(s==null?void 0:s.start_mode)==="open"&&a==="startlist"&&o("leaderboard")},[s==null?void 0:s.start_mode,a]),p.useEffect(()=>{if(a==="leaderboard"||a==="teamresult"){const n=`lastFetch-${a}-${t}`,u=sessionStorage.getItem(n);(u?Date.now()-parseInt(u):1/0)>1e4&&(console.log(`Initial fetch for ${a} view...`),N(),a==="teamresult"&&f(),sessionStorage.setItem(n,Date.now().toString()))}},[a,t,N,f]),p.useEffect(()=>{if(!t||a!=="leaderboard"&&a!=="teamresult")return;const n=setInterval(()=>{console.log(`Periodic sync for ${a} view...`),N(),a==="teamresult"&&f()},3e4);return()=>clearInterval(n)},[a,t,N,f]),y)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Loading competition..."});if(!s)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Competition not found"});const he=Pe(r),xe=Y||[];return e.jsxs(Te,{title:s.name,subtitle:d==null?void 0:d.name,onBackClick:oe,seriesId:s.series_id,seriesName:s.series_name,tourId:s.tour_id,tourName:s.tour_name,customActions:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-2 text-turf hover:text-fairway hover:bg-turf/10 rounded-xl transition-colors text-sm font-medium font-primary",title:"Share startlist",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),g&&e.jsxs(F,{to:`/player/competitions/${t}/tee-times/${g}`,className:"flex items-center gap-2 px-3 py-2 bg-coral text-scorecard rounded-xl hover:bg-[#E8890A] hover:-translate-y-0.5 transition-all duration-200 text-sm font-medium font-primary border border-coral",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to"}),e.jsx("span",{children:"Score"})]})]}),children:[e.jsxs("div",{className:"flex-1 space-y-4 md:space-y-6 p-4 md:p-6",children:[e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-fairway font-display",children:s.name})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-6 text-xs md:text-sm text-charcoal/70 font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"truncate",children:(d==null?void 0:d.name)||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsxs("span",{children:[he," participants"]})]})]}),(s==null?void 0:s.tour_id)&&s.tour_name&&e.jsx(ze,{tourId:s.tour_id,tourName:s.tour_name}),(s==null?void 0:s.series_id)&&s.series_name&&e.jsx(We,{seriesId:s.series_id,seriesName:s.series_name}),C&&ne()&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-coral/10 border border-coral/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-coral/20 rounded-full flex items-center justify-center",children:e.jsx(I,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-coral text-scorecard animate-pulse",children:"OPEN NOW"})}),e.jsxs("p",{className:"text-body-sm text-charcoal/70",children:["Open until"," ",new Date(s.open_end).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),$&&(m!=null&&m.registered)&&m.registration?e.jsx(Ee,{competitionId:parseInt(t||"0"),registration:m.registration,group:m.group,teeTimeId:m.registration.tee_time_id,participantId:m.registration.participant_id,onUpdate:()=>H(),hideActions:re}):$?e.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-turf hover:bg-fairway text-scorecard rounded-xl font-semibold text-lg transition-colors",children:[e.jsx(I,{className:"h-5 w-5"}),"Join This Round"]}):e.jsx("div",{className:"bg-rough/50 border border-soft-grey rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-body-md text-charcoal/70",children:"You must be enrolled in this tour to join rounds"})})]}),e.jsx("div",{className:"border-b border-soft-grey",children:e.jsxs("nav",{className:"flex space-x-4 md:space-x-8",children:[(s==null?void 0:s.start_mode)!=="open"&&e.jsxs("button",{onClick:()=>{o("startlist"),window.location.hash=""},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="startlist"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(A,{className:"h-3 w-3 md:h-4 md:w-4"}),"Start List"]}),e.jsxs("button",{onClick:()=>{o("leaderboard"),window.location.hash="leaderboard",console.log("Syncing data for leaderboard view..."),N()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                ${a==="leaderboard"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
              `,children:[e.jsx(B,{className:"h-3 w-3 md:h-4 md:w-4"}),"Leaderboard"]}),C&&e.jsxs("button",{onClick:()=>{o("whosplaying"),window.location.hash="whosplaying"},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="whosplaying"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx($e,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Who's Playing"}),e.jsx("span",{className:"sm:hidden",children:"Groups"})]}),!(s!=null&&s.tour_id)&&e.jsxs("button",{onClick:()=>{o("teamresult"),window.location.hash="teamresult",console.log("Syncing data for team results view..."),N(),V(),f()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="teamresult"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(He,{className:"h-3 w-3 md:h-4 md:w-4"}),"Team Result"]})]})}),a==="startlist"&&e.jsx(Qe,{teeTimes:r,teeTimesLoading:h,competitionId:t,venueType:s==null?void 0:s.venue_type}),a==="leaderboard"&&e.jsx(Ae,{leaderboard:_,leaderboardLoading:J,onParticipantClick:O,isTourCompetition:!!(s!=null&&s.tour_id),scoringMode:W,teeInfo:b,categoryTees:z,categories:K}),a==="teamresult"&&e.jsx(Je,{teamResults:xe,leaderboardLoading:q,individualResults:_,onParticipantClick:O}),a==="whosplaying"&&e.jsx(Xe,{groups:se,isLoading:te,myTeeTimeId:(M=m==null?void 0:m.registration)==null?void 0:M.tee_time_id,isOpenStart:(s==null?void 0:s.start_mode)==="open"})]}),e.jsx(Oe,{visible:x!==null,participant:ce,course:le,onClose:ie,isTourCompetition:!!(s!=null&&s.tour_id),netScoringData:de}),C&&e.jsx(Ge,{isOpen:X,onClose:()=>E(!1),competitionId:parseInt(t||"0"),competitionName:(s==null?void 0:s.name)||"",courseName:d==null?void 0:d.name,openUntil:s==null?void 0:s.open_end,onSuccess:()=>H()}),e.jsx(Ue,{open:L,onOpenChange:v,url:me,title:"Share Competition Startlist",description:"Scan this QR code to view the full startlist for this competition"})]})}export{ss as default};
