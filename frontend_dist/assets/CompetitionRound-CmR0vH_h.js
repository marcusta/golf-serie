var Pe=Object.defineProperty;var Ee=(a,t,s)=>t in a?Pe(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var pe=(a,t,s)=>Ee(a,typeof t!="symbol"?t+"":t,s);import{p as ke,j as e,l as Ae,m as De,U as ye,r as m,R as Le,q as _e,s as Re,t as Fe,v as He,w as $e,X as le,x as I,y as be,C as Ve,a as Oe,o as Me,d as Ke,e as ze,g as Be,h as Te,i as Ge,z as Ue,k as Ye,B as Je,D as We,E as Xe,F as qe,G as Ne,H as Qe,b as Ze,f as et,I as tt,J as st,P as at}from"./index-C_pOvs7y.js";import{b as nt,S as rt,f as ot,g as it,d as lt,i as ct,c as dt,a as ut,P as mt,T as ft,L as ht}from"./TeamResultComponent-BEEKAQV8.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],pt=ke("pencil",xt);function gt({competition:a,courseName:t,totalParticipants:s,variant:n="footer"}){const r=n==="header"?"bg-rough/30 rounded-xl p-4 border border-soft-grey":"bg-rough/30 border-t border-soft-grey px-4 py-2 flex-shrink-0";return e.jsx("div",{className:r,children:e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-8 text-label-sm text-charcoal font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ae,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(a.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(a.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(De,{className:"h-4 w-4 text-turf"}),e.jsx("span",{className:"truncate",children:t||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ye,{className:"h-4 w-4 text-turf"}),e.jsxs("span",{children:[s," participants"]})]})]})})}function yt({isOpen:a,onClose:t,onSave:s,participant:n}){const[r,d]=m.useState("");m.useEffect(()=>{n&&d(n.currentName||"")},[n]);const h=()=>{if(!n)return;const l=r.trim();l.length!==0&&s(n.id,l)},p=()=>{d((n==null?void 0:n.currentName)||""),t()},y=l=>{l.key==="Enter"?(l.preventDefault(),h()):l.key==="Escape"&&(l.preventDefault(),p())};return n?e.jsx(Le,{open:a,onOpenChange:t,children:e.jsxs(_e,{children:[e.jsx(Re,{className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsx(Fe,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm shadow-xl border border-soft-grey max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(He,{className:"text-lg font-semibold text-fairway font-display",children:"Edit Player Name"}),e.jsx($e,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors","aria-label":"Close",children:e.jsx(le,{className:"h-4 w-4 text-flag"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-turf font-primary",children:["Editing position:"," ",e.jsx("span",{className:"font-medium",children:n.positionName})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"player-name",className:"block text-sm font-medium text-charcoal mb-2 font-primary",children:"Player Name"}),e.jsx("input",{id:"player-name",type:"text",value:r,onChange:l=>d(l.target.value),onKeyDown:y,className:"w-full p-3 border-2 border-soft-grey rounded-xl text-charcoal font-primary focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors outline-none",placeholder:"Enter player name",autoFocus:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:p,className:"flex-1 p-3 bg-rough bg-opacity-30 text-fairway rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:r.trim().length===0,className:I("flex-1 p-3 rounded-xl font-medium font-primary transition-colors",r.trim().length>0?"bg-turf text-scorecard hover:bg-fairway":"bg-soft-grey text-soft-grey cursor-not-allowed"),children:"Save"})]})]})})]})}):null}function bt({currentHole:a,holePar:t,holeHcp:s,onPrevious:n,onNext:r,canGoPrevious:d,canGoNext:h,className:p}){return e.jsx("div",{className:I("bg-coral text-charcoal px-4 py-2","shadow-lg border-t border-coral/20",p),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,disabled:!d,className:I("p-2 rounded-lg transition-all duration-200 touch-manipulation",d?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(be,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-8 text-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Par"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:t})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"Holes"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:a})]}),s!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-label-sm font-medium text-charcoal",children:"HCP"}),e.jsx("div",{className:"text-display-sm font-bold text-charcoal font-display",children:s})]})]}),e.jsx("button",{onClick:r,disabled:!h,className:I("p-2 rounded-lg transition-all duration-200 touch-manipulation",h?"hover:bg-coral/20 active:bg-coral/30":"opacity-50 cursor-not-allowed"),children:e.jsx(Ve,{className:"w-6 h-6"})})]})})}function Nt({activeTab:a,onTabChange:t,className:s}){const n=[{id:"score",label:"Score Entry",shortLabel:"Score",icon:nt,disabled:!1},{id:"leaderboard",label:"Leaderboard",shortLabel:"Leaderboard",icon:Oe,disabled:!1},{id:"teams",label:"Team Results",shortLabel:"Teams",icon:Me,disabled:!1},{id:"participants",label:"Participants",shortLabel:"Start List",icon:ye,disabled:!1}];return e.jsx("div",{className:I("bg-scorecard border-t-2 border-soft-grey shadow-[0_-2px_8px_rgba(27,67,50,0.08)]",s),children:e.jsx("div",{className:"grid grid-cols-4 max-w-lg mx-auto",children:n.map(r=>{const d=a===r.id,h=r.icon;return e.jsxs("button",{onClick:()=>!r.disabled&&t(r.id),disabled:r.disabled,className:I("flex flex-col items-center justify-center py-3 px-2 transition-all duration-200 touch-manipulation","min-h-[60px] md:min-h-[64px] font-['Inter']",d?"text-coral bg-gradient-to-b from-coral/10 to-coral/5 border-t-2 border-coral":"text-charcoal hover:text-turf hover:bg-rough/30",r.disabled&&"opacity-50 cursor-not-allowed"),children:[e.jsx(h,{className:I("mb-1 transition-all duration-200",d?"w-6 h-6":"w-5 h-5","md:w-6 md:h-6")}),e.jsxs("span",{className:I("text-xs font-medium transition-all duration-200","md:text-sm",d&&"font-semibold"),children:[e.jsx("span",{className:"sm:hidden",children:r.shortLabel}),e.jsx("span",{className:"hidden sm:inline",children:r.label})]})]},r.id)})})})}function jt({competitionId:a,teeTimeId:t,selectedParticipantId:s}){const{data:n,isLoading:r}=Ke(a?parseInt(a):0),{data:d}=ze((n==null?void 0:n.course_id)||0),{data:h,refetch:p}=Be(a?parseInt(a):0),{data:y,isLoading:l,refetch:u}=Te(a?parseInt(a):0),i=y,{data:f,isLoading:A,refetch:D}=Ge(a?parseInt(a):0),{data:g,refetch:c}=Ue(t?parseInt(t):0),{data:j}=Ye(s||0),P=Je();return{competition:n,course:d,teeTimes:h,leaderboard:i,teamLeaderboard:f,teeTime:g,selectedParticipant:j,isLoading:r,leaderboardLoading:l,teamLeaderboardLoading:A,refetchTeeTime:c,refetchLeaderboard:u,refetchTeamLeaderboard:D,refetchTeeTimes:p,updateScoreMutation:P}}const re="golf-pending-scores",ge=3,O=class O{constructor(){}static getInstance(){return O.instance||(O.instance=new O),O.instance}addPendingScore(t,s,n){const r=this.getPendingScores(),d=`${t}-${s}`;r[d]={participantId:t,hole:s,shots:n,timestamp:Date.now(),attempts:0},this.savePendingScores(r)}removePendingScore(t,s){const n=this.getPendingScores(),r=`${t}-${s}`;delete n[r],this.savePendingScores(n)}getPendingScores(){try{const t=localStorage.getItem(re);return t?JSON.parse(t):{}}catch{return{}}}getPendingScoresArray(){const t=this.getPendingScores();return Object.values(t)}getPendingCount(){return this.getPendingScoresArray().length}markAttempted(t,s){const n=this.getPendingScores(),r=`${t}-${s}`;return n[r]?(n[r].attempts+=1,n[r].attempts>=ge&&delete n[r],this.savePendingScores(n),!!n[r]):!1}clearPendingScores(){localStorage.removeItem(re)}getRetryableScores(){return this.getPendingScoresArray().filter(t=>t.attempts<ge)}hasConnectivityIssues(){const t=this.getPendingScoresArray(),s=Math.min(...t.map(n=>n.timestamp));return t.length>0&&Date.now()-s>3e4}savePendingScores(t){try{localStorage.setItem(re,JSON.stringify(t))}catch(s){console.error("Failed to save pending scores to localStorage:",s)}}};pe(O,"instance");let oe=O;const _={TAB_CHANGE:15e3,VISIBILITY_CHANGE:6e4,PERIODIC:3e4,HOLE_NAVIGATION:2e4,INITIAL_FETCH:1e4};class H{static shouldSync(t,s){return Date.now()-t>s}static getSessionKey(t,s){return`golf-sync-${t}-${s}`}static needsInitialSync(t){return!sessionStorage.getItem(t)}static markSyncCompleted(t){sessionStorage.setItem(t,Date.now().toString())}static async handleInitialSync(t){if(!t.teeTimeId||!t.hasData)return!1;const s=this.getSessionKey("initial",t.teeTimeId);return this.needsInitialSync(s)?(console.log("Initial sync for score entry session..."),await t.onSync(),this.markSyncCompleted(s),!0):!1}static async handleTabChangeSync(t){const{newTab:s,teeTimeId:n,lastSyncTime:r}=t;s==="score"&&n&&this.shouldSync(r,_.TAB_CHANGE)&&(console.log("Syncing on tab change to score entry..."),await t.onSync()),(s==="leaderboard"||s==="teams")&&(console.log(`Syncing data for ${s} view...`),t.onLeaderboardSync&&await t.onLeaderboardSync(),s==="teams"&&t.onTeamsSync&&await t.onTeamsSync())}static async handleVisibilityChangeSync(t){return document.hidden||!t.isScoreEntry||!t.teeTimeId?!1:this.shouldSync(t.lastSyncTime,_.VISIBILITY_CHANGE)?(console.log("Syncing after returning to tab..."),await t.onSync(),!0):!1}static shouldSyncOnHoleChange(t,s){return t%3===1&&this.shouldSync(s,_.HOLE_NAVIGATION)}static async handleHoleNavigationSync(t){return t.teeTimeId&&this.shouldSyncOnHoleChange(t.currentHole,t.lastSyncTime)?(console.log(`Syncing on hole navigation to hole ${t.currentHole}...`),await t.onSync(),!0):!1}static needsInitialFetch(t,s){const n=`lastFetch-${t}-${s}`,r=sessionStorage.getItem(n);return(r?Date.now()-parseInt(r):1/0)>_.INITIAL_FETCH}static markInitialFetchCompleted(t,s){const n=`lastFetch-${t}-${s}`;sessionStorage.setItem(n,Date.now().toString())}static async handleInitialViewFetch(t,s,n,r){return this.needsInitialFetch(t,s)?(console.log(`Initial fetch for ${t} view...`),await n(),t==="teams"&&r&&await r(),this.markInitialFetchCompleted(t,s),!0):!1}static createSyncStatus(t,s){const n=t.getPendingCount();return{pendingCount:n,lastSyncTime:s,isOnline:navigator.onLine,hasConnectivityIssues:n>0&&Date.now()-s>_.PERIODIC}}static shouldRunPeriodicSync(t){return t==="leaderboard"||t==="teams"}static async handlePeriodicViewSync(t,s,n){this.shouldRunPeriodicSync(t)&&(console.log(`Periodic sync for ${t} view...`),await s(),t==="teams"&&n&&await n())}static shouldRetryPendingScores(t,s){return t.length>0||this.shouldSync(s,_.PERIODIC)}}function vt({competitionId:a,teeTimeId:t,activeTab:s,refetchTeeTime:n,refetchLeaderboard:r,refetchTeamLeaderboard:d,refetchTeeTimes:h,updateScoreMutation:p,teeTime:y}){const l=oe.getInstance(),[u,i]=m.useState(Date.now());m.useEffect(()=>{s==="score"&&t&&y&&H.handleInitialSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:u,hasData:!!y,onSync:async()=>{await n(),i(Date.now())}})},[s,t,y,n,a,u]),m.useEffect(()=>{const c=async()=>{await H.handleVisibilityChangeSync({teeTimeId:t,competitionId:a||"",activeTab:s,lastSyncTime:u,isScoreEntry:s==="score",onSync:async()=>{await n(),i(Date.now())}})&&i(Date.now())};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[s,t,u,n,a]),m.useEffect(()=>{if(!t)return;const c=setInterval(async()=>{try{let j=!1;const P=l.getRetryableScores();if(P.length>0){console.log(`Retrying ${P.length} pending scores...`),j=!0;for(const b of P)try{await p.mutateAsync({participantId:b.participantId,hole:b.hole,shots:b.shots}),l.removePendingScore(b.participantId,b.hole)}catch($){l.markAttempted(b.participantId,b.hole),console.error(`Retry failed for score ${b.participantId}-${b.hole}:`,$)}}H.shouldRetryPendingScores(P,u)&&(j||H.shouldSync(u,_.PERIODIC))&&(console.log("Syncing with server for latest scores..."),await n(),i(Date.now()))}catch(j){console.error("Sync validation failed:",j)}},_.PERIODIC);return()=>clearInterval(c)},[t,p,n,l,u]),m.useEffect(()=>{if(!a||!H.shouldRunPeriodicSync(s))return;const c=setInterval(async()=>{await H.handlePeriodicViewSync(s,async()=>{await r(),d&&await d()},async()=>{await h()}),i(Date.now())},_.PERIODIC);return()=>clearInterval(c)},[s,a,r,d,h]),m.useEffect(()=>{(s==="leaderboard"||s==="teams")&&a&&H.handleInitialViewFetch(s,a,async()=>{await r(),d&&await d()},async()=>{await h()})},[s,a,r,d,h]);const f=H.createSyncStatus(l,u),A=m.useCallback((c,j,P)=>{const b=parseInt(c);l.addPendingScore(b,j,P),p.mutate({participantId:b,hole:j,shots:P},{onSuccess:()=>{l.removePendingScore(b,j),i(Date.now())},onError:$=>{console.error("Score update failed:",$),l.markAttempted(b,j)}})},[p,l]),D=m.useCallback(async c=>{(c==="leaderboard"||c==="teams")&&(await r(),d&&await d()),(c==="teams"||c==="participants")&&await h(),i(Date.now())},[r,d,h]),g=m.useCallback(async()=>{t&&(await n(),i(Date.now()))},[n,t]);return{syncStatus:f,handleScoreUpdate:A,handleTabChangeSync:D,handleHoleNavigationSync:g}}function St(a){return a?{id:a.id.toString(),players:a.participants.map(t=>({participantId:t.id.toString(),participantName:t.team_name,participantType:Xe(t.position_name),isMultiPlayer:We(t.position_name),scores:t.score,playerNames:t.player_names}))}:null}function wt(a){return a?{id:a.id,team_name:a.team_name,position_name:a.position_name,player_names:a.player_names,score:a.score,tee_time_id:a.tee_time_id}:null}const ie=a=>`golf-current-hole-${a}`,Ct=(a,t)=>{a&&t&&sessionStorage.setItem(ie(a),t.toString())};function It({onNumberPress:a,onSpecialPress:t,onDismiss:s,visible:n,holePar:r,currentHole:d,playerName:h}){const p=i=>{a(i)},y=i=>{t(i)},l=()=>{s&&s()},u=i=>{if(i===1)return"HIO";const f=i-r;return f<=-4?"OTHER":f===-3?"ALBA":f===-2?"EAGLE":f===-1?"BIRDIE":f===0?"PAR":f===1?"BOGEY":f===2?"DOUBLE":f===3?"TRIPLE":f===4?"QUAD":f>=5?"OTHER":""};return n?e.jsxs("div",{className:I("fixed bottom-0 left-0 right-0 bg-scorecard border-t border-soft-grey transition-transform duration-300 ease-in-out z-50",n?"translate-y-0":"translate-y-full","shadow-lg rounded-t-xl"),children:[e.jsx("div",{className:"bg-turf text-scorecard px-4 py-2 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-lg font-bold font-display",children:["Hole ",d," | Par ",r]})})}),e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-soft-grey bg-rough bg-opacity-20",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm font-medium text-fairway font-primary",children:h||"Enter Score"})}),s&&e.jsx("button",{onMouseDown:i=>{i.preventDefault(),l()},className:"p-2 rounded-xl bg-rough bg-opacity-30 hover:bg-rough hover:bg-opacity-50 transition-colors touch-manipulation focus:outline-none","aria-label":"Close keyboard",children:e.jsx(le,{className:"w-5 h-5 text-fairway"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[1,2,3].map(i=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),p(i)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:u(i)})]},i))}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[4,5,6].map(i=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),p(i)},className:"h-14 bg-turf hover:bg-fairway active:bg-fairway rounded-xl text-xl font-bold text-scorecard transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:u(i)})]},i))}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 mb-1",children:[[7,8].map(i=>e.jsxs("button",{onMouseDown:f=>{f.preventDefault(),p(i)},className:"h-14 bg-rough bg-opacity-40 hover:bg-rough hover:bg-opacity-60 active:bg-rough active:bg-opacity-80 rounded-xl text-xl font-bold text-fairway transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:u(i)})]},i)),e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),y("more")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"9+"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:u(9)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),y("clear")},className:"h-14 bg-transparent border-2 border-flag text-flag hover:bg-flag/10 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"‚àí"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"GAVE UP"})]}),e.jsxs("button",{onMouseDown:i=>{i.preventDefault(),y("unreported")},className:"h-14 bg-transparent border-2 border-soft-grey text-charcoal hover:bg-rough/30 rounded-xl text-xl font-bold transition-colors touch-manipulation flex flex-col items-center justify-center focus:outline-none font-primary",children:[e.jsx("span",{children:"0"}),e.jsx("span",{className:"text-xs font-semibold uppercase mt-0.5 leading-none opacity-90",children:"CLEAR"})]})]})]})]}):null}function je({visible:a,teeTimeGroup:t,course:s,currentHole:n,onClose:r,onContinueEntry:d,onLockRound:h}){const[p,y]=m.useState(!1);return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:[e.jsxs("div",{className:I("bg-scorecard w-full max-h-[90vh] rounded-t-2xl transition-transform duration-300 ease-in-out border-t border-soft-grey","transform translate-y-0"),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-soft-grey",children:[e.jsx("button",{onClick:r,className:"p-2 hover:bg-rough hover:bg-opacity-30 rounded-xl transition-colors",children:e.jsx(be,{className:"h-5 w-5 text-fairway"})}),e.jsx("h2",{className:"text-lg font-semibold font-display text-fairway",children:"Full Scorecard"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-flag hover:bg-opacity-10 rounded-xl transition-colors",children:e.jsx(le,{className:"h-5 w-5 text-flag"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)]",children:e.jsx("div",{className:"px-2 py-4 space-y-6",children:t.players.map(l=>e.jsx(rt,{participant:{id:l.participantId,name:l.participantName,type:l.participantType,isMultiPlayer:l.isMultiPlayer,scores:l.scores},course:s,currentHole:n},l.participantId))})}),e.jsxs("div",{className:"p-4 border-t border-soft-grey space-y-3",children:[e.jsxs("button",{onClick:()=>d(n),className:"w-full bg-turf text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-fairway transition-colors font-primary",children:["Continue Entry on Hole ",n]}),h&&e.jsx("button",{onClick:()=>y(!0),className:"w-full bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize and Lock Round"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-coral bg-opacity-20 rounded-full",children:e.jsx(qe,{className:"w-6 h-6 text-coral"})}),e.jsx("h2",{className:"text-xl font-bold text-center font-display text-fairway mb-2",children:"Finalize Round"}),e.jsx("p",{className:"text-center text-charcoal mb-6 font-primary",children:"Are you sure you want to finalize and lock this round? This action cannot be undone and will prevent any further score changes."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 bg-soft-grey bg-opacity-30 text-charcoal py-3 px-4 rounded-xl font-medium hover:bg-soft-grey hover:bg-opacity-50 transition-colors font-primary",children:"Cancel"}),e.jsx("button",{onClick:()=>{y(!1),h==null||h()},className:"flex-1 bg-coral text-scorecard py-3 px-4 rounded-xl font-medium hover:bg-orange-600 transition-colors font-primary",children:"Finalize & Lock"})]})]})})})]}):null}function Pt({onScoreSubmit:a,onCancel:t}){const[s,n]=m.useState(!1),[r,d]=m.useState(""),h=m.useCallback(()=>{n(!0),d("")},[]),p=m.useCallback(()=>{n(!1),d(""),t()},[t]),y=m.useCallback(()=>{const u=parseInt(r,10);!isNaN(u)&&u>=9&&(a(u),p())},[r,a,p]),l=m.useCallback(u=>{const i=u.target.value;/^\d*$/.test(i)&&d(i)},[]);return{isVisible:s,inputValue:r,show:h,hide:p,handleSubmit:y,handleInputChange:l}}function Et({teeTimeGroup:a,course:t,onScoreUpdate:s,currentHole:n,onHoleChange:r,syncStatus:d,onPlayerNameClick:h,isReadyToFinalize:p=!1,onFinalize:y,isLocked:l=!1,competition:u}){var J;const i=()=>{for(let o=17;o>=0;o--)if(a.players.some(w=>{const N=w.scores[o];return N&&N>0}))if(a.players.every(N=>{const E=N.scores[o];return E&&E!==0})){if(o<17)return o+2}else return o+1;return 1},f=Ne(),[A,D]=m.useState(()=>i()),g=n!==void 0?n:A,[c,j]=m.useState(0),[P,b]=m.useState(!1),[$,V]=m.useState(!1),[T,z]=m.useState(!1),[W,G]=m.useState(!1),{isVisible:X,inputValue:q,show:Q,hide:U,handleSubmit:Z,handleInputChange:ee}=Pt({onScoreSubmit:o=>{v&&(s(v.participantId,g,o),L())},onCancel:()=>{b(!0)}}),v=a.players[c],k=t.holes.find(o=>o.number===g),te=o=>{let S=0,w=0;for(let N=0;N<t.holes.length;N++){const E=o.scores[N];if(E===-1)return null;E&&E>0&&(S+=E,w+=t.holes[N].par)}return w===0?null:S-w},L=()=>{c<a.players.length-1?j(c+1):(G(!0),setTimeout(()=>{G(!1);const o=g<18?g+1:1;r?r(o):D(o),j(0)},800))},B=o=>{l||(j(o),b(!0),z(!0))},R=o=>{l||v&&(s(v.participantId,g,o),L())},se=o=>{if(!l){if(o==="more")b(!1),Q();else if(o==="clear"){if(!v)return;s(v.participantId,g,-1),L()}else if(o==="unreported"){if(!v)return;s(v.participantId,g,0),L()}}},ae=()=>{b(!1),z(!1)},ne=o=>{h&&h(o.participantId,o.playerNames||null,o.participantType||"")},Y=o=>{const S=o.split(" ");if(S.length>=2){const w=S[0],N=S[1];return o.length<=14?o:w.length<=8?`${w} ${N.charAt(0)}.`:N.length<=8?`${w.charAt(0)}. ${N}`:`${w.charAt(0)}. ${N.charAt(0)}.`}return o.length>12?`${o.substring(0,11)}...`:o};return m.useEffect(()=>{const o=S=>{T&&!S.target.closest(".score-entry")&&(b(!1),z(!1))};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[T]),e.jsxs("div",{className:"score-entry flex flex-col h-screen-mobile bg-scorecard relative",children:[d&&(d.pendingCount>0||d.hasConnectivityIssues)&&e.jsx("div",{className:I("px-3 py-2 text-center text-xs font-medium",d.hasConnectivityIssues?"bg-flag text-scorecard border-b border-flag":"bg-coral text-scorecard border-b border-coral"),children:d.hasConnectivityIssues?e.jsxs("span",{children:["‚ö†Ô∏è Connection issues - ",d.pendingCount," score(s) pending"]}):e.jsxs("span",{children:["üì° Saving ",d.pendingCount," score(s)..."]})}),W&&e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-turf text-scorecard px-6 py-4 rounded-xl shadow-lg z-30 animate-pulse",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold font-display",children:["‚úì Hole ",g," Complete!"]}),e.jsxs("div",{className:"text-sm opacity-90 font-primary",children:["Moving to hole ",g<18?g+1:1,"..."]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{minHeight:"60%"},children:[e.jsx("div",{className:"bg-rough bg-opacity-30 px-4 py-2 border-b border-soft-grey",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center space-x-4 relative left-[50px]",children:[g>1&&e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:g-1}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par"," ",((J=t.holes.find(o=>o.number===g-1))==null?void 0:J.par)||4]})]}),e.jsxs("div",{className:"text-center w-12",children:[e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:g}),e.jsxs("div",{className:"text-xs text-fairway/70 font-primary",children:["Par ",(k==null?void 0:k.par)||4]})]}),e.jsx("div",{className:"w-12 h-6 opacity-0"})]})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[a.players.map((o,S)=>{const w=S===c,N=o.scores[g-1]??0,E=g>1?o.scores[g-2]??0:null,M=te(o);return e.jsx("div",{className:I("bg-scorecard rounded-lg p-4 shadow-sm border transition-all duration-200",w?"border-coral/20 shadow-md ring-2 ring-coral/10":"border-soft-grey"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>ne(o),className:"text-left w-full hover:bg-rough/10 rounded-md p-1 -m-1 transition-colors",children:o.playerNames?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:Y(o.playerNames)}),e.jsxs("p",{className:"text-label-sm text-turf font-primary",children:[o.participantName," ",o.participantType]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-body-lg font-semibold text-charcoal font-display",children:[o.participantName," ",o.participantType]}),e.jsxs("div",{className:"flex items-center gap-1 text-label-sm text-soft-grey font-primary",children:[e.jsx(pt,{className:"w-3 h-3"}),e.jsx("span",{children:"+ Add player name"})]})]})}),e.jsx("span",{className:I("text-label-sm font-medium font-primary",M!==null?it(M):"text-soft-grey"),children:M!==null?ot(M):"-"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[g>1&&e.jsx("div",{className:"text-center w-12",children:e.jsx("div",{className:"text-lg font-bold text-fairway font-display",children:lt(E||0)})}),e.jsx("button",{onClick:()=>B(S),disabled:l,className:I("w-12 h-12 rounded-full border-2 flex items-center justify-center text-label-sm font-medium touch-manipulation transition-colors",l?"border-soft-grey bg-soft-grey/20 cursor-not-allowed":"border-soft-grey bg-rough/10 text-turf hover:bg-rough/20"),children:e.jsx("span",{className:"text-lg font-bold text-fairway font-display",children:N>0?N:N===-1?"‚àí":"0"})})]})]})},o.participantId)}),!p&&e.jsxs("button",{onClick:()=>V(!0),className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-lg transition-colors mt-6 flex items-center justify-center space-x-2 font-primary",children:[e.jsx(Qe,{size:20}),e.jsx("span",{children:"View Full Scorecard"})]}),p&&!l&&e.jsx("div",{className:"bg-scorecard border-t border-soft-grey p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>V(!0),className:"flex-1 bg-turf hover:bg-fairway text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Review Scorecard"})}),e.jsx("button",{onClick:y,className:"flex-1 bg-coral hover:bg-orange-600 text-scorecard font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 font-primary",children:e.jsx("span",{children:"Complete Round"})})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-scorecard rounded-2xl shadow-xl max-w-sm w-full mx-4",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-turf bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-turf text-3xl",children:"‚úì"})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 font-display text-fairway",children:"Round Complete!"}),e.jsx("p",{className:"text-charcoal font-primary mb-8 leading-relaxed",children:"Your round has been successfully finalized and locked. All scores have been submitted and the results are now official."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{const o=window.location.pathname.split("/"),S=o[o.indexOf("competitions")+1];u!=null&&u.series_id?f({to:`/player/competitions/${S}`,hash:"teamresult"}):f({to:`/player/competitions/${S}`,hash:"leaderboard"})},className:"w-full bg-turf hover:bg-fairway text-scorecard font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:"View Leaderboard"}),e.jsx("button",{onClick:()=>{u!=null&&u.series_id?f({to:`/player/series/${u.series_id}`}):f({to:"/player"})},className:"w-full bg-soft-grey bg-opacity-30 hover:bg-soft-grey hover:bg-opacity-50 text-charcoal font-semibold py-4 px-6 rounded-xl transition-colors font-primary",children:u!=null&&u.series_id?`Back to ${u.series_name}`:"Back to Home"})]})]})})})]})]}),!l&&e.jsx(It,{visible:P,onNumberPress:R,onSpecialPress:se,holePar:(k==null?void 0:k.par)||4,currentHole:g,onDismiss:ae,teeTimeGroup:a,course:t,playerName:(v==null?void 0:v.playerNames)||`${v==null?void 0:v.participantName} ${v==null?void 0:v.participantType}`}),e.jsx(je,{visible:$,teeTimeGroup:a,course:t,currentHole:g,onClose:()=>V(!1),onContinueEntry:o=>{D(o||g),j(0),V(!1)}}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-scorecard rounded-xl p-6 w-full max-w-sm border border-soft-grey",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 font-display text-fairway",children:"Enter Score (9 or higher)"}),e.jsx("input",{type:"number",value:q,onChange:ee,className:"w-full p-3 border-2 border-soft-grey rounded-xl mb-4 text-2xl text-center font-display text-charcoal focus:border-turf focus:bg-rough focus:bg-opacity-20 transition-colors",placeholder:"Enter score",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:U,className:"flex-1 p-3 bg-rough bg-opacity-30 rounded-xl hover:bg-rough hover:bg-opacity-50 font-medium font-primary text-fairway transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Z,className:"flex-1 p-3 bg-turf text-scorecard rounded-xl hover:bg-fairway font-medium font-primary transition-colors",children:"Submit"})]})]})})]})}Array.from({length:18},(a,t)=>({number:t+1,par:Math.floor(Math.random()*2)+3}));Array(18).fill(null),Array(18).fill(null),Array(18).fill(null),Array(18).fill(null);function kt(a,t){return a?{id:a.id.toString(),name:t?t.name:`${a.course_name} ${a.teetime}`,holes:a.pars.map((s,n)=>({number:n+1,par:s}))}:null}function Rt(){var ue;const{competitionId:a,teeTimeId:t}=Ze({strict:!1}),s=()=>{if(t)return"score";const x=window.location.hash.replace("#","");return x==="teams"?"teams":x==="participants"?"participants":"leaderboard"},[n,r]=m.useState(s),[d,h]=m.useState(null),[p,y]=m.useState(null),[l,u]=m.useState(()=>{if(t){const x=ie(t),C=sessionStorage.getItem(x);if(C){const F=parseInt(C,10);if(F>=1&&F<=18)return F}}return 1}),{competition:i,course:f,teeTimes:A,leaderboard:D,teamLeaderboard:g,teeTime:c,selectedParticipant:j,isLoading:P,leaderboardLoading:b,teamLeaderboardLoading:$,refetchTeeTime:V,refetchLeaderboard:T,refetchTeamLeaderboard:z,refetchTeeTimes:W,updateScoreMutation:G}=jt({competitionId:a,teeTimeId:t,selectedParticipantId:d}),{syncStatus:X,handleScoreUpdate:q,handleTabChangeSync:Q,handleHoleNavigationSync:U}=vt({competitionId:a,teeTimeId:t,activeTab:n,refetchTeeTime:V,refetchLeaderboard:T,refetchTeamLeaderboard:z,refetchTeeTimes:W,updateScoreMutation:G,teeTime:c});et((i==null?void 0:i.series_id)||0);const Z=tt(),ee=st(),[v,k]=m.useState(!1),[te,L]=m.useState(!1);m.useEffect(()=>{t&&l&&Ct(t,l)},[t,l]),m.useEffect(()=>{if(c!=null&&c.participants&&c.participants.length>0)if(c.participants.filter(C=>Array.isArray(C.score)).length===c.participants.length){const C=ct(c.participants);k(C)}else k(!1);else k(!1)},[c]),m.useEffect(()=>{if(!c)return;const x=t?ie(t):null,C=x?sessionStorage.getItem(x):null,F=Array.isArray(c.participants)?c.participants:[],Ie=F.length===0||F.every(fe=>{const he=Array.isArray(fe.score)?fe.score:[];return he.length===0||he.every(xe=>!xe||xe===0)}),K=typeof c.start_hole=="number"?c.start_hole:void 0,me=K===1||K===10;if(Ie&&me){u(K),x&&sessionStorage.setItem(x,String(K));return}!C&&me&&(u(K),x&&sessionStorage.setItem(x,String(K)))},[c,t]);const B=St(c),R=kt(c,f),se=wt(j||null),ae=c&&f?{id:f.id.toString(),name:f.name,holes:c.pars.map((x,C)=>({number:C+1,par:x}))}:null,ne=async x=>{r(x),await Q(x)},Y=x=>{h(x)},J=()=>{h(null)},o=()=>{console.log("Round completed!")},S=(x,C,F)=>{y({id:x,currentName:C,positionName:F})},w=()=>{y(null)},N=(x,C)=>{Z.mutate({id:parseInt(x),data:{player_names:C}},{onSuccess:()=>{V(),y(null)}})},E=m.useCallback(async x=>{u(x),await U()},[U]),M=g||[],ce=dt(A),de=R==null?void 0:R.holes.find(x=>x.number===l),ve=()=>{L(!0)},Se=()=>{c!=null&&c.participants&&(c.participants.forEach(x=>{ee.mutate(x.id)}),L(!1))},we=((ue=c==null?void 0:c.participants)==null?void 0:ue.some(x=>x.is_locked))||!1;if(P)return e.jsx("div",{className:"p-4",children:"Loading competition..."});if(!i)return e.jsx("div",{className:"p-4",children:"Competition not found"});const Ce=()=>{switch(n){case"score":return!B||!R?e.jsx(At,{teeTimes:A||[],competitionId:a||""}):e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Et,{teeTimeGroup:B,course:R,onScoreUpdate:q,onComplete:o,currentHole:l,onHoleChange:E,syncStatus:X,onPlayerNameClick:S,isReadyToFinalize:v,onFinalize:ve,isLocked:we,competition:{id:i.id,series_id:i.series_id,series_name:i.series_name}})})});case"leaderboard":return e.jsx(ht,{leaderboard:D,leaderboardLoading:b,onParticipantClick:Y,isRoundView:!0});case"teams":return e.jsx(ft,{teamResults:M,leaderboardLoading:$,individualResults:D,isRoundView:!0,onParticipantClick:Y});case"participants":return e.jsx(mt,{teeTimes:A,teeTimesLoading:!1,competitionId:a||"",currentTeeTimeId:t,currentTeeTime:c,showCurrentGroup:!0,totalParticipants:ce});default:return null}};return e.jsxs(at,{title:i.name,seriesId:i.series_id,seriesName:i.series_name,className:"h-screen flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-hidden",children:Ce()}),n==="score"&&de&&e.jsx(bt,{currentHole:l,holePar:de.par,onPrevious:()=>E(Math.max(1,l-1)),onNext:()=>E(Math.min(18,l+1)),canGoPrevious:l>1,canGoNext:l<18,className:"flex-shrink-0"}),e.jsx(Nt,{activeTab:n,onTabChange:ne,className:"flex-shrink-0"}),e.jsx(gt,{competition:i,courseName:f==null?void 0:f.name,totalParticipants:ce,variant:"footer"}),e.jsx(ut,{visible:d!==null,participant:se,course:ae,onClose:J}),e.jsx(yt,{isOpen:p!==null,onClose:w,onSave:N,participant:p}),e.jsx(je,{visible:te,teeTimeGroup:B||{id:"",players:[]},course:R||{id:"",name:"",holes:[]},currentHole:l,onClose:()=>L(!1),onContinueEntry:()=>L(!1),onLockRound:Se})]})}function At({teeTimes:a,competitionId:t}){const s=Ne();return e.jsx("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-charcoal mb-4",children:"No Valid Tee Time"}),e.jsx("p",{className:"text-turf mb-6",children:"You don't have access to score entry for this competition. You can view the leaderboard or participant list instead."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s({to:`/player/competitions/${t}`}),className:"w-full bg-coral text-scorecard px-4 py-2 rounded-lg font-medium hover:bg-coral/90 transition-colors",children:"View Competition Details"}),a&&a.length>0&&e.jsxs("div",{className:"text-sm text-turf",children:[e.jsx("p",{className:"mb-2",children:"Available tee times:"}),e.jsxs("div",{className:"space-y-1",children:[a.slice(0,3).map(n=>e.jsxs("div",{className:"text-xs",children:[n.teetime," - ",n.participants.length," players"]},n.id)),a.length>3&&e.jsxs("div",{className:"text-xs",children:["... and ",a.length-3," more"]})]})]})]})]})})}export{Rt as default};
