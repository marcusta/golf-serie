import{j as e,b as H,c as G,C as re,U as k,e as O,P as L,f as ne,g as ie,r as p,h as oe,i as ce,k as le,l as de,m as me,n as he,o as xe,p as ue,q as pe,s as fe,t as ge,v as je,w as ye,G as be,x as Ne,y as ve,J as we}from"./index-CiR-QhsO.js";import{C as _e,a as Ce,g as Se,d as Le,c as Ie,P as Pe,L as ke,T as Te,b as De,e as Ee}from"./TeamResultComponent-zh82EJ85.js";function Fe({seriesId:t,seriesName:c}){return e.jsx(H,{to:"/player/series/$serieId",params:{serieId:t.toString()},className:"block border-l-4 border-turf pl-4 py-3 hover:bg-turf/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-turf"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-turf font-semibold uppercase",children:"Part of a Series"}),e.jsx("h4",{className:"font-semibold text-charcoal group-hover:text-fairway transition-colors",children:c})]})]}),e.jsx(re,{className:"h-5 w-5 text-turf/50 group-hover:text-fairway transition-colors"})]})})}function $e(t,c){const f=c?t.find(l=>l.tee_time_id===c):void 0,N=c?t.filter(l=>l.tee_time_id!==c):t,a=[],o=[],m=[];for(const l of N)l.status==="on_course"?a.push(l):l.status==="finished"?m.push(l):o.push(l);return{myGroup:f,onCourse:a,registered:o,finished:m}}function He(t){if(t.members.length===0)return 0;const c=t.members.map(f=>f.holes_played||0);return Math.min(...c)}function Ge(t){if(!t||t==="-")return;if(t==="E")return 0;const c=parseInt(t,10);return isNaN(c)?void 0:c}function Oe(t){switch(t){case"on_course":return"On Course";case"finished":return"Finished";default:return"Registered"}}function Me({groups:t,isLoading:c,myTeeTimeId:f,isOpenStart:N=!0}){if(c)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-coral border-t-transparent rounded-full"})});if(!t||t.length===0)return e.jsxs("div",{className:"text-center py-12 text-charcoal/70",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-charcoal/30"}),e.jsx("p",{className:"text-lg font-medium",children:"No players yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Players will appear here once they register"})]});const{myGroup:a,onCourse:o,registered:m,finished:l}=$e(t,f),s=t.reduce((r,n)=>r+n.members.length,0),w=o.length+((a==null?void 0:a.status)==="on_course"?1:0),d=r=>{const n=r.current_score,y=Ge(n),g=y!==void 0?Se(y):"text-charcoal";return e.jsxs("div",{className:"px-4 py-3 flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-fairway truncate",children:r.name}),e.jsxs("div",{className:"text-xs text-charcoal/50 mt-0.5",children:[r.category_name&&e.jsxs("span",{children:["(",r.category_name,") "]}),"HCP ",r.handicap!==void 0?r.handicap.toFixed(1):"-"]})]}),n&&n!=="-"&&e.jsx("div",{className:`text-sm font-semibold ml-3 ${g}`,children:n})]},r.player_id)},u=(r,n,y)=>e.jsxs("div",{className:`border-l-4 transition-colors ${y?"border-turf":"border-soft-grey hover:border-turf"}`,children:[e.jsxs("div",{className:"bg-rough/20 px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-charcoal/50 font-primary",children:[r.members.length," player",r.members.length!==1?"s":""]}),n]}),e.jsx("div",{className:"divide-y divide-soft-grey/50",children:r.members.map(d)})]},r.tee_time_id),v=r=>{if(r.status==="on_course"){const n=He(r);if(n>0)return e.jsxs("span",{className:"text-xs text-charcoal/60 font-semibold font-primary",children:["Hole ",n]})}return r.status==="finished"?e.jsx("span",{className:"text-xs text-charcoal/60 font-medium font-primary",children:"Done"}):null};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-charcoal/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsxs("span",{children:[s," players"]})]}),w>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4 text-coral"}),e.jsxs("span",{children:[w," on course"]})]})]}),a&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-turf"}),"Your Group",e.jsx("span",{className:"text-xs text-coral font-semibold",children:Oe(a.status)})]}),e.jsx("div",{className:"space-y-3",children:u(a,v(a),!0)})]}),o.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-coral"}),"On Course",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",o.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:o.map(r=>u(r,v(r)))})]}),m.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-charcoal/40"}),N?"Waiting to Start":"Not Started",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",m.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:m.map(r=>u(r))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-fairway mb-3 font-primary flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-turf"}),"Finished",e.jsxs("span",{className:"text-charcoal/50 font-normal",children:["(",l.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:l.map(r=>u(r,v(r)))})]}),!a&&o.length===0&&m.length===0&&l.length===0&&e.jsx("div",{className:"text-center py-6 text-charcoal/50 text-sm font-primary",children:"No groups in this competition."})]})}function We(){var $;const{competitionId:t}=ne({strict:!1}),c=ie({strict:!1}),f=c==null?void 0:c.fromTeeTime,N=()=>{const i=window.location.hash.replace("#","");return i==="leaderboard"?"leaderboard":i==="teamresult"?"teamresult":"startlist"},[a,o]=p.useState(N),[m,l]=p.useState(null),{data:s,isLoading:w}=oe(t?parseInt(t):0),{data:d}=ce((s==null?void 0:s.course_id)||0);le((s==null?void 0:s.series_id)||0);const{data:u,isLoading:v,refetch:r}=de(t?parseInt(t):0),{data:n,isLoading:y,refetch:g}=me(t?parseInt(t):0),_=n==null?void 0:n.entries,M=n==null?void 0:n.scoringMode,b=n==null?void 0:n.tee,U=n==null?void 0:n.categoryTees,J=n==null?void 0:n.categories,{data:W,isLoading:B,refetch:A}=he(t?parseInt(t):0),[R,T]=p.useState(!1),{data:I}=xe(),Y=s==null?void 0:s.tour_id,P=I==null?void 0:I.find(i=>i.tour_id===Y),D=(P==null?void 0:P.status)==="active",C=(s==null?void 0:s.tour_id)&&(s==null?void 0:s.start_mode)==="open",{data:x,refetch:E}=ue(C?parseInt(t||"0"):0),q=!!(s!=null&&s.tour_id),{data:z,isLoading:K}=pe(q?parseInt(t||"0"):0),Q=p.useCallback(()=>{if(!(s!=null&&s.open_start)||!(s!=null&&s.open_end))return!1;const i=new Date,h=new Date(s.open_start),S=new Date(s.open_end);return i>=h&&i<=S},[s==null?void 0:s.open_start,s==null?void 0:s.open_end]),{data:j}=fe(m||0),F=i=>{l(i)},V=()=>{l(null)},X=p.useCallback(()=>{window.history.back()},[]),Z=u&&u.length>0&&d?{id:d.id.toString(),name:d.name,holes:u[0].pars.map((i,h)=>({number:h+1,par:i}))}:null,ee=j?{id:j.id,team_name:j.team_name,position_name:j.position_name,player_names:j.player_names,score:j.score,tee_time_id:j.tee_time_id}:null,se=(()=>{if(!m||!_||!(b!=null&&b.strokeIndex))return;const i=_.find(S=>S.participant.id===m);if(!i||i.courseHandicap===void 0)return;const h=Le(i.courseHandicap,b.strokeIndex);return{strokeIndex:b.strokeIndex,handicapStrokesPerHole:h,courseHandicap:i.courseHandicap,handicapIndex:i.participant.handicap_index}})();if(p.useEffect(()=>{const i=()=>{const h=window.location.hash.replace("#","");h==="leaderboard"?o("leaderboard"):h==="teamresult"?o("teamresult"):h==="whosplaying"?o("whosplaying"):(s==null?void 0:s.start_mode)!=="open"?o("startlist"):o("leaderboard")};return window.addEventListener("hashchange",i),()=>window.removeEventListener("hashchange",i)},[s==null?void 0:s.start_mode]),p.useEffect(()=>{(s==null?void 0:s.start_mode)==="open"&&a==="startlist"&&o("leaderboard")},[s==null?void 0:s.start_mode,a]),p.useEffect(()=>{if(a==="leaderboard"||a==="teamresult"){const i=`lastFetch-${a}-${t}`,h=sessionStorage.getItem(i);(h?Date.now()-parseInt(h):1/0)>1e4&&(console.log(`Initial fetch for ${a} view...`),g(),a==="teamresult"&&r(),sessionStorage.setItem(i,Date.now().toString()))}},[a,t,g,r]),p.useEffect(()=>{if(!t||a!=="leaderboard"&&a!=="teamresult")return;const i=setInterval(()=>{console.log(`Periodic sync for ${a} view...`),g(),a==="teamresult"&&r()},3e4);return()=>clearInterval(i)},[a,t,g,r]),w)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Loading competition..."});if(!s)return e.jsx("div",{className:"p-4 text-charcoal font-primary",children:"Competition not found"});const te=Ie(u),ae=W||[];return e.jsxs(ge,{title:s.name,subtitle:d==null?void 0:d.name,onBackClick:X,seriesId:s.series_id,seriesName:s.series_name,customActions:e.jsx("div",{className:"flex items-center gap-4",children:f&&e.jsxs(H,{to:`/player/competitions/${t}/tee-times/${f}`,className:"flex items-center gap-2 px-3 py-2 bg-coral text-scorecard rounded-xl hover:bg-[#E8890A] hover:-translate-y-0.5 transition-all duration-200 text-sm font-medium font-primary border border-coral",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to"}),e.jsx("span",{children:"Score"})]})}),children:[e.jsxs("div",{className:"flex-1 space-y-4 md:space-y-6 p-4 md:p-6",children:[e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-fairway font-display",children:s.name})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 md:gap-6 text-xs md:text-sm text-charcoal/70 font-primary",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("span",{className:"sm:hidden",children:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsx("span",{className:"truncate",children:(d==null?void 0:d.name)||"Loading..."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3 md:h-4 md:w-4 text-turf"}),e.jsxs("span",{children:[te," participants"]})]})]}),(s==null?void 0:s.series_id)&&s.series_name&&e.jsx(Fe,{seriesId:s.series_id,seriesName:s.series_name}),C&&Q()&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-coral/10 border border-coral/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-coral/20 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-coral text-scorecard animate-pulse",children:"OPEN NOW"})}),e.jsxs("p",{className:"text-body-sm text-charcoal/70",children:["Open until"," ",new Date(s.open_end).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),D&&(x!=null&&x.registered)&&x.registration?e.jsx(be,{competitionId:parseInt(t||"0"),registration:x.registration,group:x.group,teeTimeId:x.registration.tee_time_id,participantId:x.registration.participant_id,onUpdate:()=>E()}):D?e.jsxs("button",{onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-turf hover:bg-fairway text-scorecard rounded-xl font-semibold text-lg transition-colors",children:[e.jsx(L,{className:"h-5 w-5"}),"Join This Round"]}):e.jsx("div",{className:"bg-rough/50 border border-soft-grey rounded-xl p-4 text-center",children:e.jsx("p",{className:"text-body-md text-charcoal/70",children:"You must be enrolled in this tour to join rounds"})})]}),e.jsx("div",{className:"border-b border-soft-grey",children:e.jsxs("nav",{className:"flex space-x-4 md:space-x-8",children:[(s==null?void 0:s.start_mode)!=="open"&&e.jsxs("button",{onClick:()=>{o("startlist"),window.location.hash=""},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="startlist"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(O,{className:"h-3 w-3 md:h-4 md:w-4"}),"Start List"]}),e.jsxs("button",{onClick:()=>{o("leaderboard"),window.location.hash="leaderboard",console.log("Syncing data for leaderboard view..."),g()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                ${a==="leaderboard"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
              `,children:[e.jsx(G,{className:"h-3 w-3 md:h-4 md:w-4"}),"Leaderboard"]}),C&&e.jsxs("button",{onClick:()=>{o("whosplaying"),window.location.hash="whosplaying"},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="whosplaying"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(Ne,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Who's Playing"}),e.jsx("span",{className:"sm:hidden",children:"Groups"})]}),!(s!=null&&s.tour_id)&&e.jsxs("button",{onClick:()=>{o("teamresult"),window.location.hash="teamresult",console.log("Syncing data for team results view..."),g(),A(),r()},className:`flex items-center gap-1 md:gap-2 py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors font-primary
                  ${a==="teamresult"?"border-coral text-coral":"border-transparent text-charcoal hover:text-turf hover:border-rough"}
                `,children:[e.jsx(ve,{className:"h-3 w-3 md:h-4 md:w-4"}),"Team Result"]})]})}),a==="startlist"&&e.jsx(Pe,{teeTimes:u,teeTimesLoading:v,competitionId:t,venueType:s==null?void 0:s.venue_type}),a==="leaderboard"&&e.jsx(ke,{leaderboard:_,leaderboardLoading:y,onParticipantClick:F,isTourCompetition:!!(s!=null&&s.tour_id),scoringMode:M,teeInfo:b,categoryTees:U,categories:J}),a==="teamresult"&&e.jsx(Te,{teamResults:ae,leaderboardLoading:B,individualResults:_,onParticipantClick:F}),a==="whosplaying"&&e.jsx(Me,{groups:z,isLoading:K,myTeeTimeId:($=x==null?void 0:x.registration)==null?void 0:$.tee_time_id,isOpenStart:(s==null?void 0:s.start_mode)==="open"})]}),e.jsx(De,{visible:m!==null,participant:ee,course:Z,onClose:V,isTourCompetition:!!(s!=null&&s.tour_id),netScoringData:se}),C&&e.jsx(we,{isOpen:R,onClose:()=>T(!1),competitionId:parseInt(t||"0"),competitionName:(s==null?void 0:s.name)||"",courseName:d==null?void 0:d.name,openUntil:s==null?void 0:s.open_end,onSuccess:()=>E()})]})}export{We as default};
